<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>SCO</title>
  <style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}

ul.task-list[class]{list-style: none;}
ul.task-list li input[type="checkbox"] {
font-size: inherit;
width: 0.8em;
margin: 0 0.8em 0.2em -1.6em;
vertical-align: middle;
}
.display.math{display: block; text-align: center; margin: 0.5rem auto;}

pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } 
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } 
code span.at { color: #204a87; } 
code span.bn { color: #0000cf; } 
code span.cf { color: #204a87; font-weight: bold; } 
code span.ch { color: #4e9a06; } 
code span.cn { color: #8f5902; } 
code span.co { color: #8f5902; font-style: italic; } 
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } 
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } 
code span.dt { color: #204a87; } 
code span.dv { color: #0000cf; } 
code span.er { color: #a40000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #0000cf; } 
code span.fu { color: #204a87; font-weight: bold; } 
code span.im { } 
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } 
code span.kw { color: #204a87; font-weight: bold; } 
code span.op { color: #ce5c00; font-weight: bold; } 
code span.ot { color: #8f5902; } 
code span.pp { color: #8f5902; font-style: italic; } 
code span.sc { color: #ce5c00; font-weight: bold; } 
code span.ss { color: #4e9a06; } 
code span.st { color: #4e9a06; } 
code span.va { color: #000000; } 
code span.vs { color: #4e9a06; } 
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } 
</style>
  <style type="text/css">{
"text-color": null,
"background-color": "#f8f8f8",
"line-number-color": "#aaaaaa",
"line-number-background-color": null,
"text-styles": {
"Alert": {
"text-color": "#ef2929",
"background-color": null,
"bold": false,
"italic": false,
"underline": false
},
"Annotation": {
"text-color": "#8f5902",
"background-color": null,
"bold": true,
"italic": true,
"underline": false
},
"Attribute": {
"text-color": "#204a87",
"background-color": null,
"bold": false,
"italic": false,
"underline": false
},
"BaseN": {
"text-color": "#0000cf",
"background-color": null,
"bold": false,
"italic": false,
"underline": false
},
"Char": {
"text-color": "#4e9a06",
"background-color": null,
"bold": false,
"italic": false,
"underline": false
},
"Comment": {
"text-color": "#8f5902",
"background-color": null,
"bold": false,
"italic": true,
"underline": false
},
"CommentVar": {
"text-color": "#8f5902",
"background-color": null,
"bold": true,
"italic": true,
"underline": false
},
"Constant": {
"text-color": "#8f5902",
"background-color": null,
"bold": false,
"italic": false,
"underline": false
},
"ControlFlow": {
"text-color": "#204a87",
"background-color": null,
"bold": true,
"italic": false,
"underline": false
},
"DataType": {
"text-color": "#204a87",
"background-color": null,
"bold": false,
"italic": false,
"underline": false
},
"DecVal": {
"text-color": "#0000cf",
"background-color": null,
"bold": false,
"italic": false,
"underline": false
},
"Documentation": {
"text-color": "#8f5902",
"background-color": null,
"bold": true,
"italic": true,
"underline": false
},
"Error": {
"text-color": "#a40000",
"background-color": null,
"bold": true,
"italic": false,
"underline": false
},
"Extension": {
"text-color": null,
"background-color": null,
"bold": false,
"italic": false,
"underline": false
},
"Float": {
"text-color": "#0000cf",
"background-color": null,
"bold": false,
"italic": false,
"underline": false
},
"Function": {
"text-color": "#204a87",
"background-color": null,
"bold": true,
"italic": false,
"underline": false
},
"Import": {
"text-color": null,
"background-color": null,
"bold": false,
"italic": false,
"underline": false
},
"Information": {
"text-color": "#8f5902",
"background-color": null,
"bold": true,
"italic": true,
"underline": false
},
"Keyword": {
"text-color": "#204a87",
"background-color": null,
"bold": true,
"italic": false,
"underline": false
},
"Operator": {
"text-color": "#ce5c00",
"background-color": null,
"bold": true,
"italic": false,
"underline": false
},
"Other": {
"text-color": "#8f5902",
"background-color": null,
"bold": false,
"italic": false,
"underline": false
},
"Preprocessor": {
"text-color": "#8f5902",
"background-color": null,
"bold": false,
"italic": true,
"underline": false
},
"SpecialChar": {
"text-color": "#ce5c00",
"background-color": null,
"bold": true,
"italic": false,
"underline": false
},
"SpecialString": {
"text-color": "#4e9a06",
"background-color": null,
"bold": false,
"italic": false,
"underline": false
},
"String": {
"text-color": "#4e9a06",
"background-color": null,
"bold": false,
"italic": false,
"underline": false
},
"Variable": {
"text-color": "#000000",
"background-color": null,
"bold": false,
"italic": false,
"underline": false
},
"VerbatimString": {
"text-color": "#4e9a06",
"background-color": null,
"bold": false,
"italic": false,
"underline": false
},
"Warning": {
"text-color": "#8f5902",
"background-color": null,
"bold": true,
"italic": true,
"underline": false
}
}
}
</style>
  <style type="text/css">html {
font-size: 100%;
overflow-y: scroll;
-webkit-text-size-adjust: 100%;
-ms-text-size-adjust: 100%;
}
body {
max-width: 64rem;
background: #fefefe;
color: #333;
font-size: 16px;
padding: 2em;
margin: auto;
}
h1, h2, h3, h4, h5, h6 {
line-height: 125%;
margin-top: 1.5em;
font-weight: normal;
}
blockquote {
color: #666;
margin: 0;
padding-left: 3em;
border-left: 0.25em #666 solid;
}
pre, code, kbd, samp {
font-family: monospace, monospace;
font-size: 14px;
}
pre {
white-space: pre;
white-space: pre-wrap;
word-wrap: break-word;
}
</style>
</head>
<body>
<h1 id="source-code-origination---opentofus-implementation-of-the-removed-block">Source
Code Origination - OpenTofu’s Implementation of the Removed Block</h1>
<h2 id="preface">Preface</h2>
<p>The functionality of the “removed” block in OpenTofu was developed
not based on the similarly named, but functionally different Terraform
feature, but rather on the already existing “moved” block in both the
OpenTofu and Terraform codebase under the MPL-2.0 license. While we do
not have information about the HashiCorp development process, it is
likely, that much of the code in Terraform also originates from the
“moved” block implementation and is, in large parts, not an original
work of authorship but rather a derivative work. This is supported by
the following comment in the Terraform codebase:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Like MoveEndpoint, RemoveTarget is a wrapping struct that captures the result</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">// of decoding an HCL traversal representing a relative path from the current</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">// module to a removeable object.</span></span></code></pre></div>
<p>To accurately show the origin of the code, in this document we will
show the differences and similarities by logical code blocks rather than
line by line, which can be misleading since the order of functions and
code blocks influences the differential view.</p>
<p>We believe that this is just a case of a misunderstanding where the
code came from.</p>
<h2 id="on-the-matter-of-using-busl-1.1-licensed-code-in-opentofu">On
the matter of using BUSL-1.1-licensed code in OpenTofu</h2>
<p>The OpenTofu team never has and will not copy, and never has and will
not knowingly accept copies of BUSL-1.1-licensed code into the OpenTofu
repository.</p>
<h2 id="on-the-matter-of-monitoring-and-accepting-third-party-submissions">On
the matter of monitoring and accepting third-party submissions</h2>
<p>On or about January ████, 2024 a community contributor submitted a
pull request (see ███████████████████) that was a direct copy of a pull
request filed against the Terraform repository (see
███████████████████). The contributor did not have any rights to the
pull request against the Terraform repository and the Terraform
contributor licensed their contribution under the BUSL-1.1 license,
which the OpenTofu team discovered and promptly rejected.</p>
<p>As a follow-up to this event, the OpenTofu core team instituted the
policy of the “taint team”. If a pull request mirroring a Terraform
feature is submitted by a contributor, one core team member is dedicated
as the “taint team” (typically the first team member reviewing the PR).
This team member compares the code in the Terraform PR and the OpenTofu
PR. If the PR is found to be likely in breach of intellectual property
rights, the pull request is closed and the contributor is barred from
working on that area of the code in the future. Multiple offenders are
banned from contributing to the OpenTofu repository as a whole. Core
team members participating in such a review regularly recuse themselves
from future work on the reviewed PR because they are unable to provide
an unbiased review.</p>
<p>As a result of this process, a core team member flagged the following
PR: ███████████████████ as being very similar to the Terraform PR
███████████████████ based on the highly specific and non-trivial go-cty
handling code present in the PR. Multiple team members were pulled into
the review, and even though unsure, the PR was rejected on the grounds
that it may be a copy. The reason for the closure was privately
communicated to the contributor.</p>
<h2 id="on-the-matter-of-educating-contributors">On the matter of
educating contributors</h2>
<p>On or about January ████, 2024 a ████ user highlighted the
similarities between the implementation of the “removed” block between
OpenTofu and Terraform (see ███████████████████). The OpenTofu team took
the allegations of possible copyright infringement by one of its own
very seriously and promptly conducted a thorough review of the code also
presented in this document. We found no wrongdoing as both
implementations are based on the “moved” block rather than on each
other. The OpenTofu code is functionally different from the Terraform
code, contains more and diverging tests and the similarities are
attributable to the “moved” block under the MPL-2.0 license.</p>
<p>Following the events described above, the core team instituted a
change to the contribution guidelines presented in the main OpenTofu
repository (
https://github.com/opentofu/opentofu/blob/main/CONTRIBUTING.md ) in
order to make clear to all contributors that copyright infringement is
not acceptable when contributing to OpenTofu (see
https://github.com/opentofu/opentofu/pull/1209 ). Specifically, the
contribution guide now contains the following section:</p>
<blockquote>
<p>A note on copyright</p>
<p>We take copyright and intellectual property very seriously. A few
quick rules should help you:</p>
<ul>
<li>When you submit a PR, you are responsible for the code in that pull
request. You signal your acceptance of the DCO with your sign-off.</li>
<li>If you include code in your PR that you didn’t write yourself, make
sure you have permission from the author. If you have permission, always
add the Co-authored-by sign-off to your commits to indicate the author
of the code you are adding.</li>
<li>Be careful about AI coding assistants! Coding assistants based on
large language models (LLMs), such as ChatGPT or GitHub Copilot, are
awesome tools to help. However, in the specific case of OpenTofu the
training data may include the BSL-licensed Terraform. Since the
OpenTofu/Terraform codebase is very specific and LLMs don’t have any
other training sources, they may emit copyrighted code. Please avoid
using LLM-based coding assistants as much as possible.</li>
<li>When you copy/paste code from within the OpenTofu code, always make
it explicit where you copied from. This helps us resolve issues later
on.</li>
<li>Before you copy code from external sources, make sure that the
license allows this. Also make sure that any licensing requirements,
such as attribution, are met. When in doubt, ask first!</li>
<li>Specifically, do not copy from the Terraform repository, or any PRs
others have filed against that repository. This code is licensed under
the BSL, a license which is not compatible with OpenTofu. (You may
submit the same PR to both Terraform and OpenTofu as long as you are the
author of both.)</li>
</ul>
<p>Warning</p>
<p>To protect the OpenTofu project from legal issues violating these
rules will immediately disqualify your PR from being merged and you from
working on that area of the OpenTofu code base in the future. Repeat
violations may get you barred from contributing to OpenTofu.</p>
</blockquote>
<p>This section is referenced in multiple places, such as in the “I’ve
been assigned an issue, now what?” section often linked to new
contributors:</p>
<blockquote>
<p>Have you read this document? If not, please give it a quick skim,
especially the sections about copyright and signoffs.</p>
</blockquote>
<p>Additionally, ever since OpenTofu’s inception, contributors are
required to sign-off their commits on the repository attesting to their
adherence to the DCO ( https://developercertificate.org/ ).</p>
<p>Finally, since March 22nd, 2024 the core team is also in the process
of refining a PR ( https://github.com/opentofu/opentofu/pull/1423 )
requiring contributors to not only sign off their commits, but also
attest to the fact that any code they have not explicitly written
themselves is marked with comments explaining their source.</p>
<h2 id="on-the-matter-of-copyright-headers">On the matter of copyright
headers</h2>
<p>The OpenTofu team has never and will not knowingly mislabel
BUSL-1.1-licensed code as MPL-2.0. It has adequate processes in place to
ensure that third party submissions also do not mislabel code with the
incorrect license.</p>
<p>OpenTofu and its predecessor, a version of Terraform shortly after
1.5.5, are licensed under the MPL-2.0 license. Much of the original code
base contained copyright headers with an SPDX license identifier as
follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Copyright (c) HashiCorp, Inc.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="an">SPDX-License-Identifier:</span><span class="co"> MPL-2.0</span></span></code></pre></div>
<p>It is customary to move code into new files or copy code within the
existing project during development and in doing so, creating a
derivative work of the original, HashiCorp-owned code under the MPL-2.0
license. If the license header was not added to newly created files, it
would likely constitute removal of copyright management information
(CMI). Unfortunately, it would not be practical to accurately keep track
of which code pieces were originally written or licensed to HashiCorp
under their CLA and which ones were purely new creations in OpenTofu.
Arguably, OpenTofu in its entirety is a derivative work of the
MPL-2.0-licensed version of Terraform. For both potential legal
complications and wishing to honor HashiCorps original copyright, the
core developer team decided to do so by adding the following headers to
all files containing code:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Copyright (c) The OpenTofu Authors</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="an">SPDX-License-Identifier:</span><span class="co"> MPL-2.0</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Copyright (c) 2023 HashiCorp, Inc.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="an">SPDX-License-Identifier:</span><span class="co"> MPL-2.0</span></span></code></pre></div>
<p>The only files that do not fall under this rule are supplemental
files that did not originally have copyright headers, such as example
code snippets in the documentation or supplemental files that were newly
added to OpenTofu only (such as the installation instructions on the
website).</p>
<h2 id="on-the-matter-of-file-names">On the matter of file names</h2>
<p>In both projects the file names presented in this document are
identical or similar. However, these file names originate with the
naming convention of the “moved” block, which has the following file
names:</p>
<ul>
<li>move_statement.go</li>
<li>move_endpoint.go</li>
<li>move_endpoint_test.go</li>
<li>moved.go</li>
<li>moved_test.go</li>
</ul>
<h2 id="on-the-matter-of-remove_statement.go">On the matter of
remove_statement.go</h2>
<p>We compare the move_statement.go (OpenTofu/Terraform, MPL-2.0),
remove_statement.go (OpenTofu, MPL-2.0) and remove_statement.go
(Terraform, BUSL-1.1) files code block by code block and remove the
comments for readability. Where we have removed code comments in the
code analysis below, all code comments differed between HashiCorp’s
BUSL-1.1-licensed code and OpenTofu’s MPL-2.0-licensed code.</p>
<h3 id="the-movestatement-struct">The MoveStatement struct</h3>
<p>We start with the move_statement.go (MPL-2.0 license):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> MoveStatement <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    From<span class="op">,</span> To  <span class="op">*</span>addrs<span class="op">.</span>MoveEndpointInModule</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    DeclRange tfdiags<span class="op">.</span>SourceRange</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    Implied <span class="dt">bool</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Comparing to the remove_statement.go in OpenTofu (MPL-2.0
license):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> RemoveStatement <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    From      addrs<span class="op">.</span>ConfigRemovable</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    DeclRange tfdiags<span class="op">.</span>SourceRange</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And to remove_statement.go in Terraform (BUSL-1.1 license):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> RemoveStatement <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    From addrs<span class="op">.</span>ConfigMoveable</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    Destroy   <span class="dt">bool</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    DeclRange tfdiags<span class="op">.</span>SourceRange</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="the-getendpointstoremove-opentofu-mpl-2.0-findremovestatements-terraform-busl-1.1-function">The
GetEndpointsToRemove (OpenTofu, MPL-2.0) / FindRemoveStatements
(Terraform, BUSL-1.1) function</h3>
<p><strong>Again, we compare the functions to the original
<code>FindMoveStatements</code> function (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// FindMoveStatements recurses through the modules of the given configuration</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">// and returns a flat set of all &quot;moved&quot; blocks defined within, in a</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">// deterministic but undefined order.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> FindMoveStatements<span class="op">(</span>rootCfg <span class="op">*</span>configs<span class="op">.</span>Config<span class="op">)</span> <span class="op">[]</span>MoveStatement <span class="op">{</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> findMoveStatements<span class="op">(</span>rootCfg<span class="op">,</span> <span class="ot">nil</span><span class="op">)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Comparing to the OpenTofu implementation
(MPL-2.0):</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// GetEndpointsToRemove recurses through the modules of the given configuration</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">// and returns an array of all &quot;removed&quot; addresses within, in a</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">// deterministic but undefined order.</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">// We also validate that the removed modules/resources configuration blocks were removed.</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> GetEndpointsToRemove<span class="op">(</span>rootCfg <span class="op">*</span>configs<span class="op">.</span>Config<span class="op">)</span> <span class="op">([]</span>addrs<span class="op">.</span>ConfigRemovable<span class="op">,</span> tfdiags<span class="op">.</span>Diagnostics<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    rm <span class="op">:=</span> findRemoveStatements<span class="op">(</span>rootCfg<span class="op">,</span> <span class="ot">nil</span><span class="op">)</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    diags <span class="op">:=</span> validateRemoveStatements<span class="op">(</span>rootCfg<span class="op">,</span> rm<span class="op">)</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    removedAddresses <span class="op">:=</span> <span class="bu">make</span><span class="op">([]</span>addrs<span class="op">.</span>ConfigRemovable<span class="op">,</span> <span class="bu">len</span><span class="op">(</span>rm<span class="op">))</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i<span class="op">,</span> rs <span class="op">:=</span> <span class="kw">range</span> rm <span class="op">{</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        removedAddresses<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> rs<span class="op">.</span>From</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> removedAddresses<span class="op">,</span> diags</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Finally, the Terraform version (BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// FindRemoveStatements recurses through the modules of the given configuration</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">// and returns a set of all &quot;removed&quot; blocks defined within after deduplication</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">// on the From address.</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Error diagnostics are returned if any resource or module targeted by a remove</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">// block is still defined in configuration.</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">// A &quot;removed&quot; block in a parent module overrides a removed block in a child</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">// module when both target the same configuration object.</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> FindRemoveStatements<span class="op">(</span>rootCfg <span class="op">*</span>configs<span class="op">.</span>Config<span class="op">)</span> <span class="op">(</span>addrs<span class="op">.</span>Map<span class="op">[</span>addrs<span class="op">.</span>ConfigMoveable<span class="op">,</span> RemoveStatement<span class="op">],</span> tfdiags<span class="op">.</span>Diagnostics<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    stmts <span class="op">:=</span> findRemoveStatements<span class="op">(</span>rootCfg<span class="op">,</span> addrs<span class="op">.</span>MakeMap<span class="op">[</span>addrs<span class="op">.</span>ConfigMoveable<span class="op">,</span> RemoveStatement<span class="op">]())</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    diags <span class="op">:=</span> validateRemoveStatements<span class="op">(</span>rootCfg<span class="op">,</span> stmts<span class="op">)</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stmts<span class="op">,</span> diags</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>It is worth noting that function names starting with the word
“validate” are customary in Go programming and there are at least 40
such occurrences in the entire codebase, such as ValidateMoves,
ValidateMoveStatementGraph, validateProviderConfig, ValidateTargetFile,
etc. In other respects, the OpenTofu implementation is functionally
dissimilar to the Terraform implementation.</p>
<h3 id="the-findremovestatements-function">The findRemoveStatements
function</h3>
<p>Here we note that upper case and lower case functions are different
in the Go programming language and should not be confused. We compare to
the findMoveStatements function in the original MPL-2.0 licensed
code:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> findMoveStatements<span class="op">(</span>cfg <span class="op">*</span>configs<span class="op">.</span>Config<span class="op">,</span> into <span class="op">[]</span>MoveStatement<span class="op">)</span> <span class="op">[]</span>MoveStatement <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    modAddr <span class="op">:=</span> cfg<span class="op">.</span>Path</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _<span class="op">,</span> mc <span class="op">:=</span> <span class="kw">range</span> cfg<span class="op">.</span>Module<span class="op">.</span>Moved <span class="op">{</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        fromAddr<span class="op">,</span> toAddr <span class="op">:=</span> addrs<span class="op">.</span>UnifyMoveEndpoints<span class="op">(</span>modAddr<span class="op">,</span> mc<span class="op">.</span>From<span class="op">,</span> mc<span class="op">.</span>To<span class="op">)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> fromAddr <span class="op">==</span> <span class="ot">nil</span> <span class="op">||</span> toAddr <span class="op">==</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Invalid combination should&#39;ve been caught during original</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>            <span class="co">// configuration decoding, in the configs package.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>            <span class="bu">panic</span><span class="op">(</span>fmt<span class="op">.</span>Sprintf<span class="op">(</span><span class="st">&quot;incompatible move endpoints in %s&quot;</span><span class="op">,</span> mc<span class="op">.</span>DeclRange<span class="op">))</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        into <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>into<span class="op">,</span> MoveStatement<span class="op">{</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>            From<span class="op">:</span>      fromAddr<span class="op">,</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>            To<span class="op">:</span>        toAddr<span class="op">,</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>            DeclRange<span class="op">:</span> tfdiags<span class="op">.</span>SourceRangeFromHCL<span class="op">(</span>mc<span class="op">.</span>DeclRange<span class="op">),</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>            Implied<span class="op">:</span>   <span class="ot">false</span><span class="op">,</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _<span class="op">,</span> childCfg <span class="op">:=</span> <span class="kw">range</span> cfg<span class="op">.</span>Children <span class="op">{</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        into <span class="op">=</span> findMoveStatements<span class="op">(</span>childCfg<span class="op">,</span> into<span class="op">)</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> into</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Comparing to the findRemoveStatements in OpenTofu (MPL-2.0):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> findRemoveStatements<span class="op">(</span>cfg <span class="op">*</span>configs<span class="op">.</span>Config<span class="op">,</span> into <span class="op">[]*</span>RemoveStatement<span class="op">)</span> <span class="op">[]*</span>RemoveStatement <span class="op">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    modAddr <span class="op">:=</span> cfg<span class="op">.</span>Path</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _<span class="op">,</span> rc <span class="op">:=</span> <span class="kw">range</span> cfg<span class="op">.</span>Module<span class="op">.</span>Removed <span class="op">{</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> removedEndpoint <span class="op">*</span>RemoveStatement</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> FromAddress <span class="op">:=</span> rc<span class="op">.</span>From<span class="op">.</span>RelSubject<span class="op">.(</span><span class="kw">type</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> addrs<span class="op">.</span>ConfigResource<span class="op">:</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>            absModule <span class="op">:=</span> <span class="bu">make</span><span class="op">(</span>addrs<span class="op">.</span>Module<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="bu">len</span><span class="op">(</span>modAddr<span class="op">)+</span><span class="bu">len</span><span class="op">(</span>FromAddress<span class="op">.</span>Module<span class="op">))</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            absModule <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>absModule<span class="op">,</span> modAddr<span class="op">...)</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            absModule <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>absModule<span class="op">,</span> FromAddress<span class="op">.</span>Module<span class="op">...)</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> absConfigResource addrs<span class="op">.</span>ConfigRemovable <span class="op">=</span> addrs<span class="op">.</span>ConfigResource<span class="op">{</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                Resource<span class="op">:</span> FromAddress<span class="op">.</span>Resource<span class="op">,</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                Module<span class="op">:</span>   absModule<span class="op">,</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>            removedEndpoint <span class="op">=</span> <span class="op">&amp;</span>RemoveStatement<span class="op">{</span>From<span class="op">:</span> absConfigResource<span class="op">,</span> DeclRange<span class="op">:</span> tfdiags<span class="op">.</span>SourceRangeFromHCL<span class="op">(</span>rc<span class="op">.</span>DeclRange<span class="op">)}</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> addrs<span class="op">.</span>Module<span class="op">:</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> absModule <span class="op">=</span> <span class="bu">make</span><span class="op">(</span>addrs<span class="op">.</span>Module<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="bu">len</span><span class="op">(</span>modAddr<span class="op">)+</span><span class="bu">len</span><span class="op">(</span>FromAddress<span class="op">))</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>            absModule <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>absModule<span class="op">,</span> modAddr<span class="op">...)</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            absModule <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>absModule<span class="op">,</span> FromAddress<span class="op">...)</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>            removedEndpoint <span class="op">=</span> <span class="op">&amp;</span>RemoveStatement<span class="op">{</span>From<span class="op">:</span> absModule<span class="op">,</span> DeclRange<span class="op">:</span> tfdiags<span class="op">.</span>SourceRangeFromHCL<span class="op">(</span>rc<span class="op">.</span>DeclRange<span class="op">)}</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">default</span><span class="op">:</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>            <span class="bu">panic</span><span class="op">(</span>fmt<span class="op">.</span>Sprintf<span class="op">(</span><span class="st">&quot;unhandled address type %T&quot;</span><span class="op">,</span> FromAddress<span class="op">))</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        into <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>into<span class="op">,</span> removedEndpoint<span class="op">)</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _<span class="op">,</span> childCfg <span class="op">:=</span> <span class="kw">range</span> cfg<span class="op">.</span>Children <span class="op">{</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>        into <span class="op">=</span> findRemoveStatements<span class="op">(</span>childCfg<span class="op">,</span> into<span class="op">)</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> into</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Comparing to the Terraform version (BUSL-1.1):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> findRemoveStatements<span class="op">(</span>cfg <span class="op">*</span>configs<span class="op">.</span>Config<span class="op">,</span> into addrs<span class="op">.</span>Map<span class="op">[</span>addrs<span class="op">.</span>ConfigMoveable<span class="op">,</span> RemoveStatement<span class="op">])</span> addrs<span class="op">.</span>Map<span class="op">[</span>addrs<span class="op">.</span>ConfigMoveable<span class="op">,</span> RemoveStatement<span class="op">]</span> <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _<span class="op">,</span> mc <span class="op">:=</span> <span class="kw">range</span> cfg<span class="op">.</span>Module<span class="op">.</span>Removed <span class="op">{</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> mc<span class="op">.</span>From<span class="op">.</span>ObjectKind<span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> addrs<span class="op">.</span>RemoveTargetResource<span class="op">:</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>            res <span class="op">:=</span> mc<span class="op">.</span>From<span class="op">.</span>RelSubject<span class="op">.(</span>addrs<span class="op">.</span>ConfigResource<span class="op">)</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>            fromAddr <span class="op">:=</span> addrs<span class="op">.</span>ConfigResource<span class="op">{</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                Module<span class="op">:</span>   <span class="bu">append</span><span class="op">(</span>cfg<span class="op">.</span>Path<span class="op">,</span> res<span class="op">.</span>Module<span class="op">...),</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                Resource<span class="op">:</span> res<span class="op">.</span>Resource<span class="op">,</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>            existingStatement<span class="op">,</span> ok <span class="op">:=</span> into<span class="op">.</span>GetOk<span class="op">(</span>fromAddr<span class="op">)</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> ok <span class="op">{</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> existingResource<span class="op">,</span> ok <span class="op">:=</span> existingStatement<span class="op">.</span>From<span class="op">.(</span>addrs<span class="op">.</span>ConfigResource<span class="op">);</span> ok <span class="op">&amp;&amp;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                    existingResource<span class="op">.</span>Equal<span class="op">(</span>fromAddr<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>            into<span class="op">.</span>Put<span class="op">(</span>fromAddr<span class="op">,</span> RemoveStatement<span class="op">{</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                From<span class="op">:</span>      fromAddr<span class="op">,</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>                Destroy<span class="op">:</span>   mc<span class="op">.</span>Destroy<span class="op">,</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>                DeclRange<span class="op">:</span> tfdiags<span class="op">.</span>SourceRangeFromHCL<span class="op">(</span>mc<span class="op">.</span>DeclRange<span class="op">),</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">})</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> addrs<span class="op">.</span>RemoveTargetModule<span class="op">:</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>            mod <span class="op">:=</span> mc<span class="op">.</span>From<span class="op">.</span>RelSubject<span class="op">.(</span>addrs<span class="op">.</span>Module<span class="op">)</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>            absMod <span class="op">:=</span> <span class="bu">append</span><span class="op">(</span>cfg<span class="op">.</span>Path<span class="op">,</span> mod<span class="op">...)</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>            existingStatement<span class="op">,</span> ok <span class="op">:=</span> into<span class="op">.</span>GetOk<span class="op">(</span>mc<span class="op">.</span>From<span class="op">.</span>RelSubject<span class="op">)</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> ok <span class="op">{</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> existingModule<span class="op">,</span> ok <span class="op">:=</span> existingStatement<span class="op">.</span>From<span class="op">.(</span>addrs<span class="op">.</span>Module<span class="op">);</span> ok <span class="op">&amp;&amp;</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>                    existingModule<span class="op">.</span>Equal<span class="op">(</span>absMod<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>            into<span class="op">.</span>Put<span class="op">(</span>absMod<span class="op">,</span> RemoveStatement<span class="op">{</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>                From<span class="op">:</span>      absMod<span class="op">,</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>                Destroy<span class="op">:</span>   mc<span class="op">.</span>Destroy<span class="op">,</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>                DeclRange<span class="op">:</span> tfdiags<span class="op">.</span>SourceRangeFromHCL<span class="op">(</span>mc<span class="op">.</span>DeclRange<span class="op">),</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>            <span class="op">})</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">default</span><span class="op">:</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>            <span class="bu">panic</span><span class="op">(</span><span class="st">&quot;Unsupported remove target kind&quot;</span><span class="op">)</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _<span class="op">,</span> childCfg <span class="op">:=</span> <span class="kw">range</span> cfg<span class="op">.</span>Children <span class="op">{</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>        into <span class="op">=</span> findRemoveStatements<span class="op">(</span>childCfg<span class="op">,</span> into<span class="op">)</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> into</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Since these blocks are lengthy to read, we will compare the functions
line by line:</p>
<p><strong>Moved (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> findMoveStatements<span class="op">(</span>cfg <span class="op">*</span>configs<span class="op">.</span>Config<span class="op">,</span> into <span class="op">[]</span>MoveStatement<span class="op">)</span> <span class="op">[]</span>MoveStatement <span class="op">{</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> findRemoveStatements<span class="op">(</span>cfg <span class="op">*</span>configs<span class="op">.</span>Config<span class="op">,</span> into <span class="op">[]*</span>RemoveStatement<span class="op">)</span> <span class="op">[]*</span>RemoveStatement <span class="op">{</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> findRemoveStatements<span class="op">(</span>cfg <span class="op">*</span>configs<span class="op">.</span>Config<span class="op">,</span> into addrs<span class="op">.</span>Map<span class="op">[</span>addrs<span class="op">.</span>ConfigMoveable<span class="op">,</span> RemoveStatement<span class="op">])</span> addrs<span class="op">.</span>Map<span class="op">[</span>addrs<span class="op">.</span>ConfigMoveable<span class="op">,</span> RemoveStatement<span class="op">]</span> <span class="op">{</span></span></code></pre></div>
<p>Here we note that <code>configs.Config</code> is a configuration
structure in the original MPL-2.0-licensed code. The <code>into</code>
parameter has a completely different type in the Terraform version (a
key-value mapping instead of a list), which makes the Terraform variant
function different to the original “moved” block.</p>
<p>The next line is present in both the “moved” and “removed”
implementation in OpenTofu (MPL-2.0), but missing from Terraform
(BUSL-1.1):</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>modAddr <span class="op">:=</span> cfg<span class="op">.</span>Path</span></code></pre></div>
<p>The next line is an iteration, which has a fixed structure in the Go
programming language.</p>
<p><strong>Moved (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _<span class="op">,</span> mc <span class="op">:=</span> <span class="kw">range</span> cfg<span class="op">.</span>Module<span class="op">.</span>Moved <span class="op">{</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _<span class="op">,</span> rc <span class="op">:=</span> <span class="kw">range</span> cfg<span class="op">.</span>Module<span class="op">.</span>Removed <span class="op">{</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _<span class="op">,</span> mc <span class="op">:=</span> <span class="kw">range</span> cfg<span class="op">.</span>Module<span class="op">.</span>Removed <span class="op">{</span></span></code></pre></div>
<p>The next switch block is not present in the “moved” block, and is
substantially dissimilar between OpenTofu and Terraform. We start with
the switch statement itself. It is worth noting that “switch” is a
language element in Go, not a Terraform-specific name.</p>
<p><strong>OpenTofu (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span> FromAddress <span class="op">:=</span> rc<span class="op">.</span>From<span class="op">.</span>RelSubject<span class="op">.(</span><span class="kw">type</span><span class="op">)</span> <span class="op">{</span></span></code></pre></div>
<p><strong>Terraform (BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span> mc<span class="op">.</span>From<span class="op">.</span>ObjectKind<span class="op">()</span> <span class="op">{</span></span></code></pre></div>
<p>We note that the type switch statement is customary in Go and appears
in the codebase in over 100 places. Specifically, the move_endpoint.go
(MPL-2.0) contains a similar switch-case:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span> relAddr <span class="op">:=</span> relAddr<span class="op">.(</span><span class="kw">type</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> ModuleInstance<span class="op">:</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// [...]</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> ModuleAddrType<span class="op">:</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// [...]</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="cf">default</span><span class="op">:</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// [...]</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Now we evaluate the individual switch cases with comments omitted for
readability as they are completely dissimilar.</p>
<p><strong>OpenTofu (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> addrs<span class="op">.</span>ConfigResource<span class="op">:</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    absModule <span class="op">:=</span> <span class="bu">make</span><span class="op">(</span>addrs<span class="op">.</span>Module<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="bu">len</span><span class="op">(</span>modAddr<span class="op">)+</span><span class="bu">len</span><span class="op">(</span>FromAddress<span class="op">.</span>Module<span class="op">))</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    absModule <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>absModule<span class="op">,</span> modAddr<span class="op">...)</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    absModule <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>absModule<span class="op">,</span> FromAddress<span class="op">.</span>Module<span class="op">...)</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> absConfigResource addrs<span class="op">.</span>ConfigRemovable <span class="op">=</span> addrs<span class="op">.</span>ConfigResource<span class="op">{</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        Resource<span class="op">:</span> FromAddress<span class="op">.</span>Resource<span class="op">,</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        Module<span class="op">:</span>   absModule<span class="op">,</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    removedEndpoint <span class="op">=</span> <span class="op">&amp;</span>RemoveStatement<span class="op">{</span>From<span class="op">:</span> absConfigResource<span class="op">,</span> DeclRange<span class="op">:</span> tfdiags<span class="op">.</span>SourceRangeFromHCL<span class="op">(</span>rc<span class="op">.</span>DeclRange<span class="op">)}</span></span></code></pre></div>
<p><strong>Terraform (BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> addrs<span class="op">.</span>RemoveTargetResource<span class="op">:</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    res <span class="op">:=</span> mc<span class="op">.</span>From<span class="op">.</span>RelSubject<span class="op">.(</span>addrs<span class="op">.</span>ConfigResource<span class="op">)</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    fromAddr <span class="op">:=</span> addrs<span class="op">.</span>ConfigResource<span class="op">{</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        Module<span class="op">:</span>   <span class="bu">append</span><span class="op">(</span>cfg<span class="op">.</span>Path<span class="op">,</span> res<span class="op">.</span>Module<span class="op">...),</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        Resource<span class="op">:</span> res<span class="op">.</span>Resource<span class="op">,</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    existingStatement<span class="op">,</span> ok <span class="op">:=</span> into<span class="op">.</span>GetOk<span class="op">(</span>fromAddr<span class="op">)</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ok <span class="op">{</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> existingResource<span class="op">,</span> ok <span class="op">:=</span> existingStatement<span class="op">.</span>From<span class="op">.(</span>addrs<span class="op">.</span>ConfigResource<span class="op">);</span> ok <span class="op">&amp;&amp;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>            existingResource<span class="op">.</span>Equal<span class="op">(</span>fromAddr<span class="op">)</span> <span class="op">{</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    into<span class="op">.</span>Put<span class="op">(</span>fromAddr<span class="op">,</span> RemoveStatement<span class="op">{</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>        From<span class="op">:</span>      fromAddr<span class="op">,</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>        Destroy<span class="op">:</span>   mc<span class="op">.</span>Destroy<span class="op">,</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> tfdiags<span class="op">.</span>SourceRangeFromHCL<span class="op">(</span>mc<span class="op">.</span>DeclRange<span class="op">),</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span></code></pre></div>
<p>Here it is worth noting that the Terraform (BUSL-1.1) code duplicates
the last section (<code>into.Put</code>) between the two cases, while
the OpenTofu (MPL-2.0) code takes a different approach and only append
to the “into” variable after the switch statement using a different
method. The OpenTofu (MPL-2.0) method is similar to the one used in the
“moved” implementation (MPL-2.0), but is dissimilar to the
implementation in Terraform (BUSL-1.1), which uses “into.Put” instead of
“append”.</p>
<p>The contents of the item placed into the “into” variable in OpenTofu
are, again, substantially similar to the original “moved” version
(MPL-2.0) present in move_statement.go:</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>into <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>into<span class="op">,</span> MoveStatement<span class="op">{</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    From<span class="op">:</span>      fromAddr<span class="op">,</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    To<span class="op">:</span>        toAddr<span class="op">,</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    DeclRange<span class="op">:</span> tfdiags<span class="op">.</span>SourceRangeFromHCL<span class="op">(</span>mc<span class="op">.</span>DeclRange<span class="op">),</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    Implied<span class="op">:</span>   <span class="ot">false</span><span class="op">,</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span></code></pre></div>
<p><strong>OpenTofu (MPL-2.0, formatted for readability):</strong></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>removedEndpoint <span class="op">=</span> <span class="op">&amp;</span>RemoveStatement<span class="op">{</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    From<span class="op">:</span> absConfigResource<span class="op">,</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    DeclRange<span class="op">:</span> tfdiags<span class="op">.</span>SourceRangeFromHCL<span class="op">(</span>rc<span class="op">.</span>DeclRange<span class="op">)</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And further down in the code:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>into <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>into<span class="op">,</span> removedEndpoint<span class="op">)</span></span></code></pre></div>
<p><strong>Terraform (BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>into<span class="op">.</span>Put<span class="op">(</span>fromAddr<span class="op">,</span> RemoveStatement<span class="op">{</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    From<span class="op">:</span>      fromAddr<span class="op">,</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    Destroy<span class="op">:</span>   mc<span class="op">.</span>Destroy<span class="op">,</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    DeclRange<span class="op">:</span> tfdiags<span class="op">.</span>SourceRangeFromHCL<span class="op">(</span>mc<span class="op">.</span>DeclRange<span class="op">),</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span></code></pre></div>
<p>Going back to the “switch” statement in question, we compare without
the dissimilar comments.</p>
<p><strong>OpenTofu (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> addrs<span class="op">.</span>Module<span class="op">:</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> absModule <span class="op">=</span> <span class="bu">make</span><span class="op">(</span>addrs<span class="op">.</span>Module<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="bu">len</span><span class="op">(</span>modAddr<span class="op">)+</span><span class="bu">len</span><span class="op">(</span>FromAddress<span class="op">))</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    absModule <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>absModule<span class="op">,</span> modAddr<span class="op">...)</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    absModule <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>absModule<span class="op">,</span> FromAddress<span class="op">...)</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    removedEndpoint <span class="op">=</span> <span class="op">&amp;</span>RemoveStatement<span class="op">{</span>From<span class="op">:</span> absModule<span class="op">,</span> DeclRange<span class="op">:</span> tfdiags<span class="op">.</span>SourceRangeFromHCL<span class="op">(</span>rc<span class="op">.</span>DeclRange<span class="op">)}</span></span></code></pre></div>
<p><strong>Terraform (BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> addrs<span class="op">.</span>RemoveTargetModule<span class="op">:</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    mod <span class="op">:=</span> mc<span class="op">.</span>From<span class="op">.</span>RelSubject<span class="op">.(</span>addrs<span class="op">.</span>Module<span class="op">)</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    absMod <span class="op">:=</span> <span class="bu">append</span><span class="op">(</span>cfg<span class="op">.</span>Path<span class="op">,</span> mod<span class="op">...)</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    existingStatement<span class="op">,</span> ok <span class="op">:=</span> into<span class="op">.</span>GetOk<span class="op">(</span>mc<span class="op">.</span>From<span class="op">.</span>RelSubject<span class="op">)</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ok <span class="op">{</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> existingModule<span class="op">,</span> ok <span class="op">:=</span> existingStatement<span class="op">.</span>From<span class="op">.(</span>addrs<span class="op">.</span>Module<span class="op">);</span> ok <span class="op">&amp;&amp;</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>            existingModule<span class="op">.</span>Equal<span class="op">(</span>absMod<span class="op">)</span> <span class="op">{</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    into<span class="op">.</span>Put<span class="op">(</span>absMod<span class="op">,</span> RemoveStatement<span class="op">{</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>        From<span class="op">:</span>      absMod<span class="op">,</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>        Destroy<span class="op">:</span>   mc<span class="op">.</span>Destroy<span class="op">,</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> tfdiags<span class="op">.</span>SourceRangeFromHCL<span class="op">(</span>mc<span class="op">.</span>DeclRange<span class="op">),</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span></code></pre></div>
<p>As before, the mechanism of appending to “into” is dissimilar.</p>
<p>The last case of the “switch” block is the default case, which is
present in the moved block (MPL-2.0) and similar code is present in over
100 places in the codebase.</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="cf">default</span><span class="op">:</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">panic</span><span class="op">(</span>fmt<span class="op">.</span>Sprintf<span class="op">(</span><span class="st">&quot;unsupported address type %T&quot;</span><span class="op">,</span> addr<span class="op">))</span></span></code></pre></div>
<p><strong>OpenTofu (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="cf">default</span><span class="op">:</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">panic</span><span class="op">(</span>fmt<span class="op">.</span>Sprintf<span class="op">(</span><span class="st">&quot;unhandled address type %T&quot;</span><span class="op">,</span> FromAddress<span class="op">))</span></span></code></pre></div>
<p><strong>Terraform (BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="cf">default</span><span class="op">:</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">panic</span><span class="op">(</span><span class="st">&quot;Unsupported remove target kind&quot;</span><span class="op">)</span></span></code></pre></div>
<p>Finally, the last block is again almost identical to the original
(MPL-2.0) “moved” block.</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _<span class="op">,</span> childCfg <span class="op">:=</span> <span class="kw">range</span> cfg<span class="op">.</span>Children <span class="op">{</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    into <span class="op">=</span> findMoveStatements<span class="op">(</span>childCfg<span class="op">,</span> into<span class="op">)</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _<span class="op">,</span> childCfg <span class="op">:=</span> <span class="kw">range</span> cfg<span class="op">.</span>Children <span class="op">{</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    into <span class="op">=</span> findRemoveStatements<span class="op">(</span>childCfg<span class="op">,</span> into<span class="op">)</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _<span class="op">,</span> childCfg <span class="op">:=</span> <span class="kw">range</span> cfg<span class="op">.</span>Children <span class="op">{</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    into <span class="op">=</span> findRemoveStatements<span class="op">(</span>childCfg<span class="op">,</span> into<span class="op">)</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="the-validateremovestatements-function">The
validateRemoveStatements function</h3>
<p>This function originates in the <code>ValidateMoves</code> function,
an MPL-2.0-licensed function, but has been heavily refactored in
OpenTofu to accommodate the functionality of the “removed” block. In
OpenTofu, the internal logic is also based on the
<code>findRemoveStatements</code> function (MPL-2.0) described above.
The code in Terraform (BUSL-1.1) likely originates in the same place. As
before, we present the entire functions and then compare the individual
parts, including any code parts that are equivalent to the
<code>ValidateMoves</code> function (MPL-2.0). We only include the
relevant parts of the <code>ValidateMoves</code> function (MPL-2.0) for
brevity.</p>
<p><strong>ValidateMoves (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> ValidateMoves<span class="op">(</span>stmts <span class="op">[]</span>MoveStatement<span class="op">,</span> rootCfg <span class="op">*</span>configs<span class="op">.</span>Config<span class="op">,</span> declaredInsts instances<span class="op">.</span>Set<span class="op">)</span> tfdiags<span class="op">.</span>Diagnostics <span class="op">{</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// [...]</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _<span class="op">,</span> stmt <span class="op">:=</span> <span class="kw">range</span> stmts <span class="op">{</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// [...]</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>                diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(&amp;</span>hcl<span class="op">.</span>Diagnostic<span class="op">{</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>                    Severity<span class="op">:</span> hcl<span class="op">.</span>DiagError<span class="op">,</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>                    Summary<span class="op">:</span>  <span class="st">&quot;Moved object still exists&quot;</span><span class="op">,</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>                    Detail<span class="op">:</span> fmt<span class="op">.</span>Sprintf<span class="op">(</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;This statement declares a move from %s, but that %s is still declared%s.</span><span class="ch">\n\n</span><span class="st">Change your configuration so that this %s will be declared as %s instead.&quot;</span><span class="op">,</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>                        absFrom<span class="op">,</span> noun<span class="op">,</span> declaredAt<span class="op">,</span> shortNoun<span class="op">,</span> absTo<span class="op">,</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>                    <span class="op">),</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>                    Subject<span class="op">:</span> stmt<span class="op">.</span>DeclRange<span class="op">.</span>ToHCL<span class="op">().</span>Ptr<span class="op">(),</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>                <span class="op">})</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// [...]</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> diags</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>OpenTofu (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> validateRemoveStatements<span class="op">(</span>cfg <span class="op">*</span>configs<span class="op">.</span>Config<span class="op">,</span> removeStatements <span class="op">[]*</span>RemoveStatement<span class="op">)</span> tfdiags<span class="op">.</span>Diagnostics <span class="op">{</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> diags tfdiags<span class="op">.</span>Diagnostics</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _<span class="op">,</span> rs <span class="op">:=</span> <span class="kw">range</span> removeStatements <span class="op">{</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>        fromAddr <span class="op">:=</span> rs<span class="op">.</span>From</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> fromAddr <span class="op">==</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>            <span class="bu">panic</span><span class="op">(</span>fmt<span class="op">.</span>Sprintf<span class="op">(</span><span class="st">&quot;incompatible Remove endpoint in %s&quot;</span><span class="op">,</span> rs<span class="op">.</span>DeclRange<span class="op">.</span>ToHCL<span class="op">()))</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> fromAddr <span class="op">:=</span> fromAddr<span class="op">.(</span><span class="kw">type</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> addrs<span class="op">.</span>ConfigResource<span class="op">:</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>            moduleConfig <span class="op">:=</span> cfg<span class="op">.</span>Descendent<span class="op">(</span>fromAddr<span class="op">.</span>Module<span class="op">)</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> moduleConfig <span class="op">!=</span> <span class="ot">nil</span> <span class="op">&amp;&amp;</span> moduleConfig<span class="op">.</span>Module<span class="op">.</span>ResourceByAddr<span class="op">(</span>fromAddr<span class="op">.</span>Resource<span class="op">)</span> <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>                diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(&amp;</span>hcl<span class="op">.</span>Diagnostic<span class="op">{</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>                    Severity<span class="op">:</span> hcl<span class="op">.</span>DiagError<span class="op">,</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>                    Summary<span class="op">:</span>  <span class="st">&quot;Removed resource block still exists&quot;</span><span class="op">,</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>                    Detail<span class="op">:</span> fmt<span class="op">.</span>Sprintf<span class="op">(</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;This statement declares a removal of the resource %s, but this resource block still exists in the configuration. Please remove the resource block.&quot;</span><span class="op">,</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>                        fromAddr<span class="op">,</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>                    <span class="op">),</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>                    Subject<span class="op">:</span> rs<span class="op">.</span>DeclRange<span class="op">.</span>ToHCL<span class="op">().</span>Ptr<span class="op">(),</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>                <span class="op">})</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> addrs<span class="op">.</span>Module<span class="op">:</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> cfg<span class="op">.</span>Descendent<span class="op">(</span>fromAddr<span class="op">)</span> <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>                diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(&amp;</span>hcl<span class="op">.</span>Diagnostic<span class="op">{</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>                    Severity<span class="op">:</span> hcl<span class="op">.</span>DiagError<span class="op">,</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>                    Summary<span class="op">:</span>  <span class="st">&quot;Removed module block still exists&quot;</span><span class="op">,</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>                    Detail<span class="op">:</span> fmt<span class="op">.</span>Sprintf<span class="op">(</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;This statement declares a removal of the module %s, but this module block still exists in the configuration. Please remove the module block.&quot;</span><span class="op">,</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>                        fromAddr<span class="op">,</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>                    <span class="op">),</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>                    Subject<span class="op">:</span> rs<span class="op">.</span>DeclRange<span class="op">.</span>ToHCL<span class="op">().</span>Ptr<span class="op">(),</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>                <span class="op">})</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">default</span><span class="op">:</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>            <span class="bu">panic</span><span class="op">(</span>fmt<span class="op">.</span>Sprintf<span class="op">(</span><span class="st">&quot;incompatible Remove endpoint address type in %s&quot;</span><span class="op">,</span> rs<span class="op">.</span>DeclRange<span class="op">.</span>ToHCL<span class="op">()))</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> diags</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Terraform (BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> validateRemoveStatements<span class="op">(</span>cfg <span class="op">*</span>configs<span class="op">.</span>Config<span class="op">,</span> stmts addrs<span class="op">.</span>Map<span class="op">[</span>addrs<span class="op">.</span>ConfigMoveable<span class="op">,</span> RemoveStatement<span class="op">])</span> <span class="op">(</span>diags tfdiags<span class="op">.</span>Diagnostics<span class="op">)</span> <span class="op">{</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _<span class="op">,</span> rst <span class="op">:=</span> <span class="kw">range</span> stmts<span class="op">.</span>Keys<span class="op">()</span> <span class="op">{</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> rst <span class="op">:=</span> rst<span class="op">.(</span><span class="kw">type</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> addrs<span class="op">.</span>ConfigResource<span class="op">:</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>            m <span class="op">:=</span> cfg<span class="op">.</span>Descendent<span class="op">(</span>rst<span class="op">.</span>Module<span class="op">)</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> m <span class="op">==</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> r <span class="op">:=</span> m<span class="op">.</span>Module<span class="op">.</span>ResourceByAddr<span class="op">(</span>rst<span class="op">.</span>Resource<span class="op">);</span> r <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>                diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(&amp;</span>hcl<span class="op">.</span>Diagnostic<span class="op">{</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>                    Severity<span class="op">:</span> hcl<span class="op">.</span>DiagError<span class="op">,</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>                    Summary<span class="op">:</span>  <span class="st">&quot;Removed resource still exists&quot;</span><span class="op">,</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>                    Detail<span class="op">:</span>   fmt<span class="op">.</span>Sprintf<span class="op">(</span><span class="st">&quot;This statement declares that %s was removed, but it is still declared in configuration.&quot;</span><span class="op">,</span> rst<span class="op">),</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>                    Subject<span class="op">:</span>  r<span class="op">.</span>DeclRange<span class="op">.</span>Ptr<span class="op">(),</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">})</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> addrs<span class="op">.</span>Module<span class="op">:</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> m <span class="op">:=</span> cfg<span class="op">.</span>Descendent<span class="op">(</span>rst<span class="op">);</span> m <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>                diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(&amp;</span>hcl<span class="op">.</span>Diagnostic<span class="op">{</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>                    Severity<span class="op">:</span> hcl<span class="op">.</span>DiagError<span class="op">,</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>                    Summary<span class="op">:</span>  <span class="st">&quot;Removed module still exists&quot;</span><span class="op">,</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>                    Detail<span class="op">:</span>   fmt<span class="op">.</span>Sprintf<span class="op">(</span><span class="st">&quot;This statement declares that %s was removed, but it is still declared in configuration.&quot;</span><span class="op">,</span> rst<span class="op">),</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>                    Subject<span class="op">:</span>  m<span class="op">.</span>CallRange<span class="op">.</span>Ptr<span class="op">(),</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>                <span class="op">})</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> diags</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Since the function is long, again, we will go line by line.</p>
<p><strong>ValidateMoves (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> ValidateMoves<span class="op">(</span>stmts <span class="op">[]</span>MoveStatement<span class="op">,</span> rootCfg <span class="op">*</span>configs<span class="op">.</span>Config<span class="op">,</span> declaredInsts instances<span class="op">.</span>Set<span class="op">)</span> tfdiags<span class="op">.</span>Diagnostics <span class="op">{</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> validateRemoveStatements<span class="op">(</span>cfg <span class="op">*</span>configs<span class="op">.</span>Config<span class="op">,</span> removeStatements <span class="op">[]*</span>RemoveStatement<span class="op">)</span> tfdiags<span class="op">.</span>Diagnostics <span class="op">{</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> validateRemoveStatements<span class="op">(</span>cfg <span class="op">*</span>configs<span class="op">.</span>Config<span class="op">,</span> stmts addrs<span class="op">.</span>Map<span class="op">[</span>addrs<span class="op">.</span>ConfigMoveable<span class="op">,</span> RemoveStatement<span class="op">])</span> <span class="op">(</span>diags tfdiags<span class="op">.</span>Diagnostics<span class="op">)</span> <span class="op">{</span></span></code></pre></div>
<p>In both the OpenTofu (MPL-2.0) and Terraform (BUSL-1.1) version, the
arguments and return values are similar to <code>ValidateMoves</code>
(MPL-2.0).</p>
<p>The next line is present only in OpenTofu (MPL-2.0), as the Terraform
(BUSL-1.1) variant includes this in the function declaration (an
uncommon Go programming technique not used or known by many).</p>
<p><strong>OpenTofu (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> diags tfdiags<span class="op">.</span>Diagnostics</span></code></pre></div>
<p>The next block, again, is an iteration over all remove statements and
the corresponding checks.</p>
<p><strong>OpenTofu (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _<span class="op">,</span> rs <span class="op">:=</span> <span class="kw">range</span> removeStatements <span class="op">{</span></span></code></pre></div>
<p><strong>Terraform (BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _<span class="op">,</span> rst <span class="op">:=</span> <span class="kw">range</span> stmts<span class="op">.</span>Keys<span class="op">()</span> <span class="op">{</span></span></code></pre></div>
<p>As noted before, the “for” and “range” keywords are inherent to the
Go language and are not specific to Terraform (BUSL-1.1). In fact, this
is the most obvious way to write an iteration and writing it differently
would make the code unnecessarily complicated and possibly have a
performance impact.</p>
<p>The next section is present in OpenTofu (MPL-2.0) and missing in
Terraform (BUSL-1.1). It hardens the code against bugs as indicated by
the comment:</p>
<p><strong>OpenTofu (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fromAddr <span class="op">:=</span> rs<span class="op">.</span>From</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> fromAddr <span class="op">==</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Invalid value should&#39;ve been caught during original</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// configuration decoding, in the configs package.</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">panic</span><span class="op">(</span>fmt<span class="op">.</span>Sprintf<span class="op">(</span><span class="st">&quot;incompatible Remove endpoint in %s&quot;</span><span class="op">,</span> rs<span class="op">.</span>DeclRange<span class="op">.</span>ToHCL<span class="op">()))</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The next section performs a switch-case similar to
<code>findRemoveStatements</code> (MPL-2.0).</p>
<p><strong>OpenTofu (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span> fromAddr <span class="op">:=</span> fromAddr<span class="op">.(</span><span class="kw">type</span><span class="op">)</span> <span class="op">{</span></span></code></pre></div>
<p><strong>Terraform (BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span> rst <span class="op">:=</span> rst<span class="op">.(</span><span class="kw">type</span><span class="op">)</span> <span class="op">{</span></span></code></pre></div>
<p>Again, we note that “switch” and “(type)” are specific to the Go
language, not Terraform (BUSL-1.1). Next, we compare the cases in the
switch. Here we also include the relevant part from the original
<code>ValidateMoves</code> function (MPL-2.0):</p>
<p><strong>ValidateMoves (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>        diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(&amp;</span>hcl<span class="op">.</span>Diagnostic<span class="op">{</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>            Severity<span class="op">:</span> hcl<span class="op">.</span>DiagError<span class="op">,</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>            Summary<span class="op">:</span>  <span class="st">&quot;Moved object still exists&quot;</span><span class="op">,</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>            Detail<span class="op">:</span> fmt<span class="op">.</span>Sprintf<span class="op">(</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;This statement declares a move from %s, but that %s is still declared%s.</span><span class="ch">\n\n</span><span class="st">Change your configuration so that this %s will be declared as %s instead.&quot;</span><span class="op">,</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                absFrom<span class="op">,</span> noun<span class="op">,</span> declaredAt<span class="op">,</span> shortNoun<span class="op">,</span> absTo<span class="op">,</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">),</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>            Subject<span class="op">:</span> stmt<span class="op">.</span>DeclRange<span class="op">.</span>ToHCL<span class="op">().</span>Ptr<span class="op">(),</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span></code></pre></div>
<p><strong>OpenTofu (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> addrs<span class="op">.</span>ConfigResource<span class="op">:</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    moduleConfig <span class="op">:=</span> cfg<span class="op">.</span>Descendent<span class="op">(</span>fromAddr<span class="op">.</span>Module<span class="op">)</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> moduleConfig <span class="op">!=</span> <span class="ot">nil</span> <span class="op">&amp;&amp;</span> moduleConfig<span class="op">.</span>Module<span class="op">.</span>ResourceByAddr<span class="op">(</span>fromAddr<span class="op">.</span>Resource<span class="op">)</span> <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>        diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(&amp;</span>hcl<span class="op">.</span>Diagnostic<span class="op">{</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>            Severity<span class="op">:</span> hcl<span class="op">.</span>DiagError<span class="op">,</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>            Summary<span class="op">:</span>  <span class="st">&quot;Removed resource block still exists&quot;</span><span class="op">,</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>            Detail<span class="op">:</span> fmt<span class="op">.</span>Sprintf<span class="op">(</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;This statement declares a removal of the resource %s, but this resource block still exists in the configuration. Please remove the resource block.&quot;</span><span class="op">,</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>                fromAddr<span class="op">,</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">),</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>            Subject<span class="op">:</span> rs<span class="op">.</span>DeclRange<span class="op">.</span>ToHCL<span class="op">().</span>Ptr<span class="op">(),</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<p><strong>Terraform (BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> addrs<span class="op">.</span>ConfigResource<span class="op">:</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    m <span class="op">:=</span> cfg<span class="op">.</span>Descendent<span class="op">(</span>rst<span class="op">.</span>Module<span class="op">)</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> m <span class="op">==</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> r <span class="op">:=</span> m<span class="op">.</span>Module<span class="op">.</span>ResourceByAddr<span class="op">(</span>rst<span class="op">.</span>Resource<span class="op">);</span> r <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>        diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(&amp;</span>hcl<span class="op">.</span>Diagnostic<span class="op">{</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>            Severity<span class="op">:</span> hcl<span class="op">.</span>DiagError<span class="op">,</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>            Summary<span class="op">:</span>  <span class="st">&quot;Removed resource still exists&quot;</span><span class="op">,</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>            Detail<span class="op">:</span>   fmt<span class="op">.</span>Sprintf<span class="op">(</span><span class="st">&quot;This statement declares that %s was removed, but it is still declared in configuration.&quot;</span><span class="op">,</span> rst<span class="op">),</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>            Subject<span class="op">:</span>  r<span class="op">.</span>DeclRange<span class="op">.</span>Ptr<span class="op">(),</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<p>Here there are only two similarities. The <code>cfg.Descendent</code>
call is a call to the MPL-2.0-licensed <code>Config</code> structure
discussed before and is the only practical way to retrieve a descendant
config. The same is true for the call to <code>ResourceByAddr</code>,
which is the only practical way to retrieve the resource associated with
an address entered by the user. Both implementations check if the module
configuration is <code>nil</code> (empty value), which is again
necessary and customary to do in the Go programming language. However,
the OpenTofu (MPL-2.0) implementation structures this differently and is
more compact than the Terraform (BUSL-1.1) implementation. A similar
calling structure is also present in <code>transform_diff.go</code>
(MPL-2.0 license):</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> t<span class="op">.</span>Config <span class="op">==</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ot">false</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>cfg <span class="op">:=</span> t<span class="op">.</span>Config<span class="op">.</span>DescendentForInstance<span class="op">(</span>addr<span class="op">.</span>Module<span class="op">)</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> cfg <span class="op">==</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ot">false</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>res <span class="op">:=</span> cfg<span class="op">.</span>Module<span class="op">.</span>ResourceByAddr<span class="op">(</span>addr<span class="op">.</span>ConfigResource<span class="op">().</span>Resource<span class="op">)</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> res <span class="op">==</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ot">false</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Similar error handling is also present in <code>import.go</code>
(MPL-2.0):</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>targetConfig <span class="op">:=</span> config<span class="op">.</span>DescendentForInstance<span class="op">(</span>addr<span class="op">.</span>Module<span class="op">)</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> targetConfig <span class="op">==</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    modulePath <span class="op">:=</span> addr<span class="op">.</span>Module<span class="op">.</span>String<span class="op">()</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(&amp;</span>hcl<span class="op">.</span>Diagnostic<span class="op">{</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>        Severity<span class="op">:</span> hcl<span class="op">.</span>DiagError<span class="op">,</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>        Summary<span class="op">:</span>  <span class="st">&quot;Import to non-existent module&quot;</span><span class="op">,</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        Detail<span class="op">:</span> fmt<span class="op">.</span>Sprintf<span class="op">(</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;%s is not defined in the configuration. Please add configuration for this module before importing into it.&quot;</span><span class="op">,</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>            modulePath<span class="op">,</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">),</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    c<span class="op">.</span>showDiagnostics<span class="op">(</span>diags<span class="op">)</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>As discussed before, the diagnostics return block is wide spread in
the code base and is not specific to the BUSL-1.1-licensed Terraform
code.</p>
<p>The same analysis applies to the second case, which deals with
modules.</p>
<p><strong>OpenTofu (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> cfg<span class="op">.</span>Descendent<span class="op">(</span>fromAddr<span class="op">)</span> <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(&amp;</span>hcl<span class="op">.</span>Diagnostic<span class="op">{</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>        Severity<span class="op">:</span> hcl<span class="op">.</span>DiagError<span class="op">,</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>        Summary<span class="op">:</span>  <span class="st">&quot;Removed module block still exists&quot;</span><span class="op">,</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>        Detail<span class="op">:</span> fmt<span class="op">.</span>Sprintf<span class="op">(</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;This statement declares a removal of the module %s, but this module block still exists in the configuration. Please remove the module block.&quot;</span><span class="op">,</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>            fromAddr<span class="op">,</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">),</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>        Subject<span class="op">:</span> rs<span class="op">.</span>DeclRange<span class="op">.</span>ToHCL<span class="op">().</span>Ptr<span class="op">(),</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Terraform (BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> m <span class="op">:=</span> cfg<span class="op">.</span>Descendent<span class="op">(</span>rst<span class="op">);</span> m <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(&amp;</span>hcl<span class="op">.</span>Diagnostic<span class="op">{</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>        Severity<span class="op">:</span> hcl<span class="op">.</span>DiagError<span class="op">,</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>        Summary<span class="op">:</span>  <span class="st">&quot;Removed module still exists&quot;</span><span class="op">,</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>        Detail<span class="op">:</span>   fmt<span class="op">.</span>Sprintf<span class="op">(</span><span class="st">&quot;This statement declares that %s was removed, but it is still declared in configuration.&quot;</span><span class="op">,</span> rst<span class="op">),</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>        Subject<span class="op">:</span>  m<span class="op">.</span>CallRange<span class="op">.</span>Ptr<span class="op">(),</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="on-the-matter-of-move_endpoint.go">On the matter of
move_endpoint.go</h2>
<p>This section will proceed as before. However, it is worth noting that
the BUSL-1.1-licensed Terraform code calls out to the prior art that
served as inspiration for this code in the first comment of this
file:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Like MoveEndpoint, RemoveTarget is a wrapping struct that captures the result</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co">// of decoding an HCL traversal representing a relative path from the current</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co">// module to a removeable object.</span></span></code></pre></div>
<h3 id="the-removeendpoint-opentofu-mpl-2.0-and-removetarget-terraform-busl-1.1-structs">The
RemoveEndpoint (OpenTofu, MPL-2.0) and RemoveTarget (Terraform,
BUSL-1.1) structs</h3>
<p>First, we will inspect the struct itself and then the receiver
functions defined on this struct.</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">// MoveEndpoint is to AbsMoveable and ConfigMoveable what Target is to</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Targetable: a wrapping struct that captures the result of decoding an HCL</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co">// traversal representing a relative path from the current module to</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">// a moveable object.</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Its name reflects that its primary purpose is for the &quot;from&quot; and &quot;to&quot;</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">// addresses in a &quot;moved&quot; statement in the configuration, but it&#39;s also</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co">// valid to use MoveEndpoint for other similar mechanisms that give</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co">// OpenTofu hints about historical configuration changes that might</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co">// prompt creating a different plan than OpenTofu would by default.</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co">// To obtain a full address from a MoveEndpoint you must use</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co">// either the package function UnifyMoveEndpoints (to get an AbsMoveable) or</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co">// the method ConfigMoveable (to get a ConfigMoveable).</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> MoveEndpoint <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// SourceRange is the location of the physical endpoint address</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// in configuration, if this MoveEndpoint was decoded from a</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// configuration expresson.</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    SourceRange tfdiags<span class="op">.</span>SourceRange</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Internally we (ab)use AbsMoveable as the representation of our</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// relative address, even though everywhere else in OpenTofu</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// AbsMoveable always represents a fully-absolute address.</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// In practice, due to the implementation of ParseMoveEndpoint,</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// this is always either a ModuleInstance or an AbsResourceInstance,</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// and we only consider the possibility of interpreting it as</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// a AbsModuleCall or an AbsResource in UnifyMoveEndpoints.</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// This is intentionally unexported to encapsulate this unusual</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// meaning of AbsMoveable.</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>    relSubject AbsMoveable</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">// RemoveEndpoint is to ConfigRemovable what Target is to Targetable:</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co">// a wrapping struct that captures the result of decoding an HCL</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co">// traversal representing a relative path from the current module to</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co">// a removable object. It is very similar to MoveEndpoint.</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Its purpose is to represent the &quot;from&quot; address in a &quot;removed&quot; block</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co">// in the configuration.</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co">// To obtain a full address from a RemoveEndpoint we need to combine it</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="co">// with any ancestor modules in the configuration</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> RemoveEndpoint <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// SourceRange is the location of the physical endpoint address</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// in configuration, if this RemoveEndpoint was decoded from a</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// configuration expression.</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>    SourceRange tfdiags<span class="op">.</span>SourceRange</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// the representation of our relative address as a ConfigRemovable</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>    RelSubject ConfigRemovable</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Like MoveEndpoint, RemoveTarget is a wrapping struct that captures the result</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co">// of decoding an HCL traversal representing a relative path from the current</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co">// module to a removeable object.</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Remove targets are somewhat simpler than move endpoints, in that they deal</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co">// only with resources and modules defined in configuration, not instances of</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co">// those objects as recorded in state. We are therefore able to determine the</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co">// ConfigMoveable up front, since specifying any resource or module instance key</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co">// in a removed block is invalid.</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co">// An interesting quirk of RemoveTarget is that RelSubject denotes a</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="co">// configuration object that, if the removed block is valid, should no longer</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co">// exist in configuration. This &quot;last known address&quot; is used to locate and delete</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co">// the appropriate state objects, or, in the case in which the user has forgotten</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="co">// to remove the object from configuration, to report the address of that block</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="co">// in an error diagnostic.</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> RemoveTarget <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// SourceRange is the location of the target address in configuration.</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>    SourceRange tfdiags<span class="op">.</span>SourceRange</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// RelSubject, like MoveEndpoint&#39;s relSubject, abuses an absolute address</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// type to represent a relative address.</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>    RelSubject ConfigMoveable</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Note that the <code>ObjectKind</code>, <code>String</code> and
<code>Equal</code> receiver functions present in Terraform (BUSL-1.1)
are not present in OpenTofu (MPL-2.0).</p>
<h3 id="the-parseremoveendpoint-opentofu-mpl-2.0-and-parseremovetarget-terraform-busl-1.1-functions">The
ParseRemoveEndpoint (OpenTofu, MPL-2.0) and ParseRemoveTarget
(Terraform, BUSL-1.1) functions</h3>
<p>These functions both originate in the <code>ParseMoveEndpoint</code>
(MPL-2.0) function.</p>
<p><strong>ParseMoveEndpoint (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ParseMoveEndpoint attempts to interpret the given traversal as a</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co">// &quot;move endpoint&quot; address, which is a relative path from the module containing</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co">// the traversal to a movable object in either the same module or in some</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co">// child module.</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co">// This deals only with the syntactic element of a move endpoint expression</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co">// in configuration. Before the result will be useful you&#39;ll need to combine</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="co">// it with the address of the module where it was declared in order to get</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co">// an absolute address relative to the root module.</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> ParseMoveEndpoint<span class="op">(</span>traversal hcl<span class="op">.</span>Traversal<span class="op">)</span> <span class="op">(*</span>MoveEndpoint<span class="op">,</span> tfdiags<span class="op">.</span>Diagnostics<span class="op">)</span> <span class="op">{</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    path<span class="op">,</span> remain<span class="op">,</span> diags <span class="op">:=</span> parseModuleInstancePrefix<span class="op">(</span>traversal<span class="op">)</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ot">nil</span><span class="op">,</span> diags</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>    rng <span class="op">:=</span> tfdiags<span class="op">.</span>SourceRangeFromHCL<span class="op">(</span>traversal<span class="op">.</span>SourceRange<span class="op">())</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span><span class="op">(</span>remain<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">&amp;</span>MoveEndpoint<span class="op">{</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>            relSubject<span class="op">:</span>  path<span class="op">,</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>            SourceRange<span class="op">:</span> rng<span class="op">,</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span> diags</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>    riAddr<span class="op">,</span> moreDiags <span class="op">:=</span> parseResourceInstanceUnderModule<span class="op">(</span>path<span class="op">,</span> remain<span class="op">)</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>    diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(</span>moreDiags<span class="op">)</span></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ot">nil</span><span class="op">,</span> diags</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">&amp;</span>MoveEndpoint<span class="op">{</span></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>        relSubject<span class="op">:</span>  riAddr<span class="op">,</span></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>        SourceRange<span class="op">:</span> rng<span class="op">,</span></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span> diags</span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>ParseRemoveEndpoint (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ParseRemoveEndpoint attempts to interpret the given traversal as a</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co">// &quot;remove endpoint&quot; address, which is a relative path from the module containing</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co">// the traversal to a removable object in either the same module or in some</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">// child module.</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co">// This deals only with the syntactic element of a remove endpoint expression</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co">// in configuration. Before the result will be useful you&#39;ll need to combine</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co">// it with the address of the module where it was declared in order to get</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co">// an absolute address relative to the root module.</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> ParseRemoveEndpoint<span class="op">(</span>traversal hcl<span class="op">.</span>Traversal<span class="op">)</span> <span class="op">(*</span>RemoveEndpoint<span class="op">,</span> tfdiags<span class="op">.</span>Diagnostics<span class="op">)</span> <span class="op">{</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    path<span class="op">,</span> remain<span class="op">,</span> diags <span class="op">:=</span> parseModulePrefix<span class="op">(</span>traversal<span class="op">)</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ot">nil</span><span class="op">,</span> diags</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    rng <span class="op">:=</span> tfdiags<span class="op">.</span>SourceRangeFromHCL<span class="op">(</span>traversal<span class="op">.</span>SourceRange<span class="op">())</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span><span class="op">(</span>remain<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">&amp;</span>RemoveEndpoint<span class="op">{</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>            RelSubject<span class="op">:</span>  path<span class="op">,</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>            SourceRange<span class="op">:</span> rng<span class="op">,</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span> diags</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>    riAddr<span class="op">,</span> moreDiags <span class="op">:=</span> parseResourceUnderModule<span class="op">(</span>path<span class="op">,</span> remain<span class="op">)</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>    diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(</span>moreDiags<span class="op">)</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ot">nil</span><span class="op">,</span> diags</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> riAddr<span class="op">.</span>Resource<span class="op">.</span>Mode <span class="op">==</span> DataResourceMode <span class="op">{</span></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>        diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(&amp;</span>hcl<span class="op">.</span>Diagnostic<span class="op">{</span></span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>            Severity<span class="op">:</span> hcl<span class="op">.</span>DiagError<span class="op">,</span></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>            Summary<span class="op">:</span>  <span class="st">&quot;Data source address is not allowed&quot;</span><span class="op">,</span></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>            Detail<span class="op">:</span>   <span class="st">&quot;Data sources cannot be destroyed, and therefore, &#39;removed&#39; blocks are not allowed to target them. To remove data sources from the state, you should remove the data source block from the configuration.&quot;</span><span class="op">,</span></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>            Subject<span class="op">:</span>  traversal<span class="op">.</span>SourceRange<span class="op">().</span>Ptr<span class="op">(),</span></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ot">nil</span><span class="op">,</span> diags</span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">&amp;</span>RemoveEndpoint<span class="op">{</span></span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a>        RelSubject<span class="op">:</span>  riAddr<span class="op">,</span></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>        SourceRange<span class="op">:</span> rng<span class="op">,</span></span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span> diags</span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>ParseRemoveTarget (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> ParseRemoveTarget<span class="op">(</span>traversal hcl<span class="op">.</span>Traversal<span class="op">)</span> <span class="op">(*</span>RemoveTarget<span class="op">,</span> tfdiags<span class="op">.</span>Diagnostics<span class="op">)</span> <span class="op">{</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    path<span class="op">,</span> remain<span class="op">,</span> diags <span class="op">:=</span> parseModulePrefix<span class="op">(</span>traversal<span class="op">)</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ot">nil</span><span class="op">,</span> diags</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    rng <span class="op">:=</span> tfdiags<span class="op">.</span>SourceRangeFromHCL<span class="op">(</span>traversal<span class="op">.</span>SourceRange<span class="op">())</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span><span class="op">(</span>remain<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">&amp;</span>RemoveTarget<span class="op">{</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>            RelSubject<span class="op">:</span>  path<span class="op">,</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>            SourceRange<span class="op">:</span> rng<span class="op">,</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span> diags</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>    rAddr<span class="op">,</span> moreDiags <span class="op">:=</span> parseConfigResourceUnderModule<span class="op">(</span>path<span class="op">,</span> remain<span class="op">)</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>    diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(</span>moreDiags<span class="op">)</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ot">nil</span><span class="op">,</span> diags</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rAddr<span class="op">.</span>Resource<span class="op">.</span>Mode <span class="op">==</span> DataResourceMode <span class="op">{</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>        diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(&amp;</span>hcl<span class="op">.</span>Diagnostic<span class="op">{</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>            Severity<span class="op">:</span> hcl<span class="op">.</span>DiagError<span class="op">,</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>            Summary<span class="op">:</span>  <span class="st">&quot;Data source address not allowed&quot;</span><span class="op">,</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>            Detail<span class="op">:</span>   <span class="st">&quot;Data sources are never destroyed, so they are not valid targets of removed blocks. To remove the data source from state, remove the data source block from configuration.&quot;</span><span class="op">,</span></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>            Subject<span class="op">:</span>  rng<span class="op">.</span>ToHCL<span class="op">().</span>Ptr<span class="op">(),</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">&amp;</span>RemoveTarget<span class="op">{</span></span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>        RelSubject<span class="op">:</span>  rAddr<span class="op">,</span></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>        SourceRange<span class="op">:</span> rng<span class="op">,</span></span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span> diags</span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The only difference to the <code>MoveEndpoint</code> in both
implementation is the testing for the presence of data sources. The lack
of this test in OpenTofu (MPL-2.0) was originally raised as part of the
code review process here (
https://github.com/opentofu/opentofu/pull/1158#discussion_r1463578492 )
and subsequently fixed by the developer writing this code in commit
686a809575a3afe3ed6ca6df4d7de825110019b6. As the developer was using
GitHub Copilot at the time, the error message was likely created by the
AI assistant and when prompted, the same AI assistant was producing a
similar error message when testing for this report. However, we do not
have accurate records of this event as we do not require contributors to
screen-record their coding sessions.</p>
<h2 id="on-the-matter-of-the-remove_endpoint_test.go-opentofu-mpl-2.0-and-remove_target_test.go-terraform-busl-1.1-files">On
the matter of the remove_endpoint_test.go (OpenTofu, MPL-2.0) and
remove_target_test.go (Terraform, BUSL-1.1) files</h2>
<p>The OpenTofu (MPL-2.0) implementation originates in the
move_endpoint_test.go (MPL-2.0) file, which contains very similar test
cases. It is worth noting that the OpenTofu (MPL-2.0) implementation has
27 test cases, whereas the Terraform (BUSL-1.1) implementation contains
only 8.</p>
<p>Since the test definition is very long, we’ll first highlight the
general structure of the <code>TestParseMoveEndpoint</code> (MPL-2.0)
function, then the <code>TestParseRemoveEndpoint</code> (OpenTofu,
MPL-2.0) function, and finally the <code>TestParseRemoveTarget</code>
(Terraform BUSL-1.1) function.</p>
<p><strong><code>TestParseMoveEndpoint</code> (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> TestParseMoveEndpoint<span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    tests <span class="op">:=</span> <span class="op">[]</span><span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>        Input   <span class="dt">string</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>        WantRel AbsMoveable <span class="co">// funny intermediate subset of AbsMoveable</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>        WantErr <span class="dt">string</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}{</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// [...]</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _<span class="op">,</span> test <span class="op">:=</span> <span class="kw">range</span> tests <span class="op">{</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>        t<span class="op">.</span>Run<span class="op">(</span>test<span class="op">.</span>Input<span class="op">,</span> <span class="kw">func</span><span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>            traversal<span class="op">,</span> hclDiags <span class="op">:=</span> hclsyntax<span class="op">.</span>ParseTraversalAbs<span class="op">([]</span><span class="dt">byte</span><span class="op">(</span>test<span class="op">.</span>Input<span class="op">),</span> <span class="st">&quot;&quot;</span><span class="op">,</span> hcl<span class="op">.</span>InitialPos<span class="op">)</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> hclDiags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>                <span class="co">// We&#39;re not trying to test the HCL parser here, so any</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>                <span class="co">// failures at this point are likely to be bugs in the</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>                <span class="co">// test case itself.</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>                t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;syntax error: %s&quot;</span><span class="op">,</span> hclDiags<span class="op">.</span>Error<span class="op">())</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>            moveEp<span class="op">,</span> diags <span class="op">:=</span> ParseMoveEndpoint<span class="op">(</span>traversal<span class="op">)</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">switch</span> <span class="op">{</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> test<span class="op">.</span>WantErr <span class="op">!=</span> <span class="st">&quot;&quot;</span><span class="op">:</span></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">!</span>diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;unexpected success</span><span class="ch">\n</span><span class="st">want error: %s&quot;</span><span class="op">,</span> test<span class="op">.</span>WantErr<span class="op">)</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>                gotErr <span class="op">:=</span> diags<span class="op">.</span>Err<span class="op">().</span>Error<span class="op">()</span></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> gotErr <span class="op">!=</span> test<span class="op">.</span>WantErr <span class="op">{</span></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;wrong error</span><span class="ch">\n</span><span class="st">got:  %s</span><span class="ch">\n</span><span class="st">want: %s&quot;</span><span class="op">,</span> gotErr<span class="op">,</span> test<span class="op">.</span>WantErr<span class="op">)</span></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">default</span><span class="op">:</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;unexpected error: %s&quot;</span><span class="op">,</span> diags<span class="op">.</span>Err<span class="op">().</span>Error<span class="op">())</span></span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> diff <span class="op">:=</span> cmp<span class="op">.</span>Diff<span class="op">(</span>test<span class="op">.</span>WantRel<span class="op">,</span> moveEp<span class="op">.</span>relSubject<span class="op">);</span> diff <span class="op">!=</span> <span class="st">&quot;&quot;</span> <span class="op">{</span></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Errorf<span class="op">(</span><span class="st">&quot;wrong result</span><span class="ch">\n</span><span class="st">%s&quot;</span><span class="op">,</span> diff<span class="op">)</span></span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong><code>TestParseRemoveEndpoint</code> (OpenTofu,
MPL-2.0):</strong></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> TestParseRemoveEndpoint<span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    tests <span class="op">:=</span> <span class="op">[]</span><span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>        Input   <span class="dt">string</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>        WantRel ConfigRemovable</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>        WantErr <span class="dt">string</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}{</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// [...]    </span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _<span class="op">,</span> test <span class="op">:=</span> <span class="kw">range</span> tests <span class="op">{</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>        t<span class="op">.</span>Run<span class="op">(</span>test<span class="op">.</span>Input<span class="op">,</span> <span class="kw">func</span><span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>            traversal<span class="op">,</span> hclDiags <span class="op">:=</span> hclsyntax<span class="op">.</span>ParseTraversalAbs<span class="op">([]</span><span class="dt">byte</span><span class="op">(</span>test<span class="op">.</span>Input<span class="op">),</span> <span class="st">&quot;&quot;</span><span class="op">,</span> hcl<span class="op">.</span>InitialPos<span class="op">)</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> hclDiags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>                <span class="co">// We&#39;re not trying to test the HCL parser here, so any</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>                <span class="co">// failures at this point are likely to be bugs in the</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>                <span class="co">// test case itself.</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>                t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;syntax error: %s&quot;</span><span class="op">,</span> hclDiags<span class="op">.</span>Error<span class="op">())</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>            moveEp<span class="op">,</span> diags <span class="op">:=</span> ParseRemoveEndpoint<span class="op">(</span>traversal<span class="op">)</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">switch</span> <span class="op">{</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> test<span class="op">.</span>WantErr <span class="op">!=</span> <span class="st">&quot;&quot;</span><span class="op">:</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">!</span>diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;unexpected success</span><span class="ch">\n</span><span class="st">want error: %s&quot;</span><span class="op">,</span> test<span class="op">.</span>WantErr<span class="op">)</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>                gotErr <span class="op">:=</span> diags<span class="op">.</span>Err<span class="op">().</span>Error<span class="op">()</span></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> gotErr <span class="op">!=</span> test<span class="op">.</span>WantErr <span class="op">{</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;wrong error</span><span class="ch">\n</span><span class="st">got:  %s</span><span class="ch">\n</span><span class="st">want: %s&quot;</span><span class="op">,</span> gotErr<span class="op">,</span> test<span class="op">.</span>WantErr<span class="op">)</span></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">default</span><span class="op">:</span></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;unexpected error: %s&quot;</span><span class="op">,</span> diags<span class="op">.</span>Err<span class="op">().</span>Error<span class="op">())</span></span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> diff <span class="op">:=</span> cmp<span class="op">.</span>Diff<span class="op">(</span>test<span class="op">.</span>WantRel<span class="op">,</span> moveEp<span class="op">.</span>RelSubject<span class="op">);</span> diff <span class="op">!=</span> <span class="st">&quot;&quot;</span> <span class="op">{</span></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Errorf<span class="op">(</span><span class="st">&quot;wrong result</span><span class="ch">\n</span><span class="st">%s&quot;</span><span class="op">,</span> diff<span class="op">)</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong><code>TestParseRemoveTarget</code> (BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> TestParseRemoveTarget<span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    tests <span class="op">:=</span> <span class="op">[]</span><span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>        Input   <span class="dt">string</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>        Want    ConfigMoveable</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>        WantErr <span class="dt">string</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}{</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// [...]        </span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _<span class="op">,</span> test <span class="op">:=</span> <span class="kw">range</span> tests <span class="op">{</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>        t<span class="op">.</span>Run<span class="op">(</span>test<span class="op">.</span>Input<span class="op">,</span> <span class="kw">func</span><span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>            traversal<span class="op">,</span> hclDiags <span class="op">:=</span> hclsyntax<span class="op">.</span>ParseTraversalAbs<span class="op">([]</span><span class="dt">byte</span><span class="op">(</span>test<span class="op">.</span>Input<span class="op">),</span> <span class="st">&quot;&quot;</span><span class="op">,</span> hcl<span class="op">.</span>InitialPos<span class="op">)</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> hclDiags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>                <span class="co">// We&#39;re not trying to test the HCL parser here, so any</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>                <span class="co">// failures at this point are likely to be bugs in the</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>                <span class="co">// test case itself.</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>                t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;syntax error: %s&quot;</span><span class="op">,</span> hclDiags<span class="op">.</span>Error<span class="op">())</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>            remT<span class="op">,</span> diags <span class="op">:=</span> ParseRemoveTarget<span class="op">(</span>traversal<span class="op">)</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">switch</span> <span class="op">{</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> test<span class="op">.</span>WantErr <span class="op">!=</span> <span class="st">&quot;&quot;</span><span class="op">:</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">!</span>diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;unexpected success</span><span class="ch">\n</span><span class="st">want error: %s&quot;</span><span class="op">,</span> test<span class="op">.</span>WantErr<span class="op">)</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>                gotErr <span class="op">:=</span> diags<span class="op">.</span>Err<span class="op">().</span>Error<span class="op">()</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> gotErr <span class="op">!=</span> test<span class="op">.</span>WantErr <span class="op">{</span></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;wrong error</span><span class="ch">\n</span><span class="st">got:  %s</span><span class="ch">\n</span><span class="st">want: %s&quot;</span><span class="op">,</span> gotErr<span class="op">,</span> test<span class="op">.</span>WantErr<span class="op">)</span></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">default</span><span class="op">:</span></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;unexpected error: %s&quot;</span><span class="op">,</span> diags<span class="op">.</span>Err<span class="op">().</span>Error<span class="op">())</span></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> diff <span class="op">:=</span> cmp<span class="op">.</span>Diff<span class="op">(</span>test<span class="op">.</span>Want<span class="op">,</span> remT<span class="op">.</span>RelSubject<span class="op">);</span> diff <span class="op">!=</span> <span class="st">&quot;&quot;</span> <span class="op">{</span></span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Errorf<span class="op">(</span><span class="st">&quot;wrong result</span><span class="ch">\n</span><span class="st">%s&quot;</span><span class="op">,</span> diff<span class="op">)</span></span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Since the test framework is virtually identical to the original,
MPL-2.0-licensed code, we will now compare the test cases. We would like
to note that the test structure is mandated largely by technical
necessity.</p>
<p>Now we will go over the individual test cases, listing every
Terraform (BUSL-1.1) test case and attempting to find an OpenTofu
(MPL-2.0) equivalent test case, which is not always possible. It is
worth noting that these test cases are required by logic, otherwise the
code could not be covered adequately.</p>
<h4 id="case-1">Case 1:</h4>
<p>This case tests a resource without a module, which is the most basic
test case.</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">`foo.bar`</span><span class="op">,</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    AbsResourceInstance<span class="op">{</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>        Module<span class="op">:</span> RootModuleInstance<span class="op">,</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>        Resource<span class="op">:</span> ResourceInstance<span class="op">{</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>            Resource<span class="op">:</span> Resource<span class="op">{</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>                Mode<span class="op">:</span> ManagedResourceMode<span class="op">,</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>                Type<span class="op">:</span> <span class="st">&quot;foo&quot;</span><span class="op">,</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>                Name<span class="op">:</span> <span class="st">&quot;bar&quot;</span><span class="op">,</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>            Key<span class="op">:</span> NoKey<span class="op">,</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">`foo.bar`</span><span class="op">,</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    ConfigResource<span class="op">{</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>        Module<span class="op">:</span> RootModule<span class="op">,</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>        Resource<span class="op">:</span> Resource<span class="op">{</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>            Mode<span class="op">:</span> ManagedResourceMode<span class="op">,</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>            Type<span class="op">:</span> <span class="st">&quot;foo&quot;</span><span class="op">,</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>            Name<span class="op">:</span> <span class="st">&quot;bar&quot;</span><span class="op">,</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">`test_instance.bar`</span><span class="op">,</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    ConfigResource<span class="op">{</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>        Module<span class="op">:</span> RootModule<span class="op">,</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>        Resource<span class="op">:</span> Resource<span class="op">{</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>            Mode<span class="op">:</span> ManagedResourceMode<span class="op">,</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>            Type<span class="op">:</span> <span class="st">&quot;test_instance&quot;</span><span class="op">,</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>            Name<span class="op">:</span> <span class="st">&quot;bar&quot;</span><span class="op">,</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="case-2">Case 2:</h4>
<p>This test case tests a resource inside a module. OpenTofu (MPL-2.0)
has two test cases to cover this case, whereas Terraform (BUSL-1.1) and
the Moved (MPL-2.0) implementation only have one.</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">`module.foo.bar.baz`</span><span class="op">,</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    RootModule<span class="op">,</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    ConfigResource<span class="op">{</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>        Module<span class="op">:</span> Module<span class="op">{</span><span class="st">&quot;foo&quot;</span><span class="op">},</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>        Resource<span class="op">:</span> Resource<span class="op">{</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>            Mode<span class="op">:</span> ManagedResourceMode<span class="op">,</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>            Type<span class="op">:</span> <span class="st">&quot;bar&quot;</span><span class="op">,</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>            Name<span class="op">:</span> <span class="st">&quot;baz&quot;</span><span class="op">,</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">`module.boop`</span><span class="op">,</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    Module<span class="op">{</span><span class="st">&quot;boop&quot;</span><span class="op">},</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`module.boop.foo.bar`</span><span class="op">,</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    ConfigResource<span class="op">{</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>        Module<span class="op">:</span> Module<span class="op">{</span><span class="st">&quot;boop&quot;</span><span class="op">},</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>        Resource<span class="op">:</span> Resource<span class="op">{</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>            Mode<span class="op">:</span> ManagedResourceMode<span class="op">,</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>            Type<span class="op">:</span> <span class="st">&quot;foo&quot;</span><span class="op">,</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>            Name<span class="op">:</span> <span class="st">&quot;bar&quot;</span><span class="op">,</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">`module.foo.test_instance.bar`</span><span class="op">,</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    ConfigResource<span class="op">{</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>        Module<span class="op">:</span> <span class="op">[]</span><span class="dt">string</span><span class="op">{</span><span class="st">&quot;foo&quot;</span><span class="op">},</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>        Resource<span class="op">:</span> Resource<span class="op">{</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>            Mode<span class="op">:</span> ManagedResourceMode<span class="op">,</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>            Type<span class="op">:</span> <span class="st">&quot;test_instance&quot;</span><span class="op">,</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>            Name<span class="op">:</span> <span class="st">&quot;bar&quot;</span><span class="op">,</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="case-3">Case 3:</h4>
<p>This test case shows a resource in a module in a module, which is an
extension of test case 2.</p>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">`module.boop.module.bip.foo.bar`</span><span class="op">,</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    ConfigResource<span class="op">{</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>        Module<span class="op">:</span> Module<span class="op">{</span><span class="st">&quot;boop&quot;</span><span class="op">,</span> <span class="st">&quot;bip&quot;</span><span class="op">},</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>        Resource<span class="op">:</span> Resource<span class="op">{</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>            Mode<span class="op">:</span> ManagedResourceMode<span class="op">,</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>            Type<span class="op">:</span> <span class="st">&quot;foo&quot;</span><span class="op">,</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>            Name<span class="op">:</span> <span class="st">&quot;bar&quot;</span><span class="op">,</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">`module.foo.module.baz.test_instance.bar`</span><span class="op">,</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    ConfigResource<span class="op">{</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>        Module<span class="op">:</span> <span class="op">[]</span><span class="dt">string</span><span class="op">{</span><span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="st">&quot;baz&quot;</span><span class="op">},</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>        Resource<span class="op">:</span> Resource<span class="op">{</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>            Mode<span class="op">:</span> ManagedResourceMode<span class="op">,</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>            Type<span class="op">:</span> <span class="st">&quot;test_instance&quot;</span><span class="op">,</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>            Name<span class="op">:</span> <span class="st">&quot;bar&quot;</span><span class="op">,</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="case-4-and-5">Case 4 and 5:</h4>
<p>These test cases test that data sources are not supported. This is
the data source equivalent of case 1 and case 2. There is no equivalent
code in move_endpoint_test.go (MPL-2.0) because the “moved” endpoint
supports data sources. It is worth noting that the error messages are
the exact error messages emitted by the code by
<code>ParseRemoveEndpoint</code> (OpenTofu, MPL-2.0) /
<code>ParseRemoveEndpoint</code> (Terraform, BUSL-1.1). The entire test
case is strictly required on a technical level to achieve testing the
code. It is also worth noting that there is no logical equivalent of the
Terraform (BUSL-1.1) case 5.</p>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">`data.foo.bar`</span><span class="op">,</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">nil</span><span class="op">,</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`Data source address is not allowed: Data sources cannot be destroyed, and therefore, &#39;removed&#39; blocks are not allowed to target them. To remove data sources from the state, you should remove the data source block from the configuration.`</span><span class="op">,</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">`data.test_ds.moo`</span><span class="op">,</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">nil</span><span class="op">,</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`Data source address not allowed: Data sources are never destroyed, so they are not valid targets of removed blocks. To remove the data source from state, remove the data source block from configuration.`</span><span class="op">,</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`module.foo.data.test_ds.noo`</span><span class="op">,</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">nil</span><span class="op">,</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`Data source address not allowed: Data sources are never destroyed, so they are not valid targets of removed blocks. To remove the data source from state, remove the data source block from configuration.`</span><span class="op">,</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="case-6-7-8">Case 6, 7, 8:</h4>
<p>These test cases test numbered instances or modules. Case 7 is not
present in OpenTofu (MPL-2.0).</p>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">`foo.bar[0]`</span><span class="op">,</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">nil</span><span class="op">,</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`Resource instance address with keys is not allowed: Resource address cannot be a resource instance (e.g. &quot;null_resource.a[0]&quot;), it must be a resource instead (e.g. &quot;null_resource.a&quot;).`</span><span class="op">,</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co">// [...]</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`module.boop.foo.bar[0]`</span><span class="op">,</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">nil</span><span class="op">,</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">`Resource instance address with keys is not allowed: Resource address cannot be a resource instance (e.g. &quot;null_resource.a[0]&quot;), it must be a resource instead (e.g. &quot;null_resource.a&quot;).`</span><span class="op">,</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL 1.1):</strong></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">`test_instance.foo[0]`</span><span class="op">,</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">nil</span><span class="op">,</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`Resource instance keys not allowed: Resource address must be a resource (e.g. &quot;test_instance.foo&quot;), not a resource instance (e.g. &quot;test_instance.foo[1]&quot;).`</span><span class="op">,</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`module.foo[0].test_instance.bar`</span><span class="op">,</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">nil</span><span class="op">,</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`Module instance keys not allowed: Module address must be a module (e.g. &quot;module.foo&quot;), not a module instance (e.g. &quot;module.foo[1]&quot;).`</span><span class="op">,</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">`module.foo.test_instance.bar[0]`</span><span class="op">,</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>    <span class="ot">nil</span><span class="op">,</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">`Resource instance keys not allowed: Resource address must be a resource (e.g. &quot;test_instance.foo&quot;), not a resource instance (e.g. &quot;test_instance.foo[1]&quot;).`</span><span class="op">,</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="cases-not-present-in-terraform-busl-1.1">Cases not present in
Terraform (BUSL-1.1)</h4>
<p>As mentioned before, OpenTofu (MPL-2.0) has 27 test cases, whereas
the Terraform (BUSL-1.1) implementation contains only 8. As shown above,
some test cases originate with the “moved” block (MPL-2.0), while other
test cases are diverging or logically necessary to write tests that
cover all desired behavior.</p>
<h2 id="on-the-matter-of-removed.go">On the matter of removed.go</h2>
<p>As before, the removed.go file is based on the moved.go (MPL-2.0)
file in OpenTofu (MPL-2.0), which appears to be the case in Terraform
(BUSL-1.1) as well.</p>
<h3 id="the-removed-struct">The Removed struct</h3>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Moved <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    From <span class="op">*</span>addrs<span class="op">.</span>MoveEndpoint</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    To   <span class="op">*</span>addrs<span class="op">.</span>MoveEndpoint</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    DeclRange hcl<span class="op">.</span>Range</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Removed <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    From <span class="op">*</span>addrs<span class="op">.</span>RemoveEndpoint</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    DeclRange hcl<span class="op">.</span>Range</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb80"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Removed <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    From <span class="op">*</span>addrs<span class="op">.</span>RemoveTarget</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    Destroy <span class="dt">bool</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    DeclRange hcl<span class="op">.</span>Range</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="the-decoderemovedblock-function">The decodeRemovedBlock
function</h3>
<p>As before, we will first list the entire function and then go line by
line.</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> decodeMovedBlock<span class="op">(</span>block <span class="op">*</span>hcl<span class="op">.</span>Block<span class="op">)</span> <span class="op">(*</span>Moved<span class="op">,</span> hcl<span class="op">.</span>Diagnostics<span class="op">)</span> <span class="op">{</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> diags hcl<span class="op">.</span>Diagnostics</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    moved <span class="op">:=</span> <span class="op">&amp;</span>Moved<span class="op">{</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> block<span class="op">.</span>DefRange<span class="op">,</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    content<span class="op">,</span> moreDiags <span class="op">:=</span> block<span class="op">.</span>Body<span class="op">.</span>Content<span class="op">(</span>movedBlockSchema<span class="op">)</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> moreDiags<span class="op">...)</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> attr<span class="op">,</span> exists <span class="op">:=</span> content<span class="op">.</span>Attributes<span class="op">[</span><span class="st">&quot;from&quot;</span><span class="op">];</span> exists <span class="op">{</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>        from<span class="op">,</span> traversalDiags <span class="op">:=</span> hcl<span class="op">.</span>AbsTraversalForExpr<span class="op">(</span>attr<span class="op">.</span>Expr<span class="op">)</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>        diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> traversalDiags<span class="op">...)</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">!</span>traversalDiags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>            from<span class="op">,</span> fromDiags <span class="op">:=</span> addrs<span class="op">.</span>ParseMoveEndpoint<span class="op">(</span>from<span class="op">)</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>            diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> fromDiags<span class="op">.</span>ToHCL<span class="op">()...)</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>            moved<span class="op">.</span>From <span class="op">=</span> from</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> attr<span class="op">,</span> exists <span class="op">:=</span> content<span class="op">.</span>Attributes<span class="op">[</span><span class="st">&quot;to&quot;</span><span class="op">];</span> exists <span class="op">{</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>        to<span class="op">,</span> traversalDiags <span class="op">:=</span> hcl<span class="op">.</span>AbsTraversalForExpr<span class="op">(</span>attr<span class="op">.</span>Expr<span class="op">)</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>        diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> traversalDiags<span class="op">...)</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">!</span>traversalDiags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>            to<span class="op">,</span> toDiags <span class="op">:=</span> addrs<span class="op">.</span>ParseMoveEndpoint<span class="op">(</span>to<span class="op">)</span></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>            diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> toDiags<span class="op">.</span>ToHCL<span class="op">()...)</span></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>            moved<span class="op">.</span>To <span class="op">=</span> to</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// we can only move from a module to a module, resource to resource, etc.</span></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">!</span>diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">!</span>moved<span class="op">.</span>From<span class="op">.</span>MightUnifyWith<span class="op">(</span>moved<span class="op">.</span>To<span class="op">)</span> <span class="op">{</span></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>            <span class="co">// We can catch some obviously-wrong combinations early here,</span></span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a>            <span class="co">// but we still have other dynamic validation to do at runtime.</span></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a>            diags <span class="op">=</span> diags<span class="op">.</span>Append<span class="op">(&amp;</span>hcl<span class="op">.</span>Diagnostic<span class="op">{</span></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>                Severity<span class="op">:</span> hcl<span class="op">.</span>DiagError<span class="op">,</span></span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a>                Summary<span class="op">:</span>  <span class="st">&quot;Invalid </span><span class="ch">\&quot;</span><span class="st">moved</span><span class="ch">\&quot;</span><span class="st"> addresses&quot;</span><span class="op">,</span></span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a>                Detail<span class="op">:</span>   <span class="st">&quot;The </span><span class="ch">\&quot;</span><span class="st">from</span><span class="ch">\&quot;</span><span class="st"> and </span><span class="ch">\&quot;</span><span class="st">to</span><span class="ch">\&quot;</span><span class="st"> addresses must either both refer to resources or both refer to modules.&quot;</span><span class="op">,</span></span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a>                Subject<span class="op">:</span>  <span class="op">&amp;</span>moved<span class="op">.</span>DeclRange<span class="op">,</span></span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a>            <span class="op">})</span></span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> moved<span class="op">,</span> diags</span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> decodeRemovedBlock<span class="op">(</span>block <span class="op">*</span>hcl<span class="op">.</span>Block<span class="op">)</span> <span class="op">(*</span>Removed<span class="op">,</span> hcl<span class="op">.</span>Diagnostics<span class="op">)</span> <span class="op">{</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> diags hcl<span class="op">.</span>Diagnostics</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    removed <span class="op">:=</span> <span class="op">&amp;</span>Removed<span class="op">{</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> block<span class="op">.</span>DefRange<span class="op">,</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    content<span class="op">,</span> moreDiags <span class="op">:=</span> block<span class="op">.</span>Body<span class="op">.</span>Content<span class="op">(</span>removedBlockSchema<span class="op">)</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> moreDiags<span class="op">...)</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> attr<span class="op">,</span> exists <span class="op">:=</span> content<span class="op">.</span>Attributes<span class="op">[</span><span class="st">&quot;from&quot;</span><span class="op">];</span> exists <span class="op">{</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>        from<span class="op">,</span> traversalDiags <span class="op">:=</span> hcl<span class="op">.</span>AbsTraversalForExpr<span class="op">(</span>attr<span class="op">.</span>Expr<span class="op">)</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>        diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> traversalDiags<span class="op">...)</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">!</span>traversalDiags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>            from<span class="op">,</span> fromDiags <span class="op">:=</span> addrs<span class="op">.</span>ParseRemoveEndpoint<span class="op">(</span>from<span class="op">)</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>            diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> fromDiags<span class="op">.</span>ToHCL<span class="op">()...)</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>            removed<span class="op">.</span>From <span class="op">=</span> from</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> removed<span class="op">,</span> diags</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> decodeRemovedBlock<span class="op">(</span>block <span class="op">*</span>hcl<span class="op">.</span>Block<span class="op">)</span> <span class="op">(*</span>Removed<span class="op">,</span> hcl<span class="op">.</span>Diagnostics<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> diags hcl<span class="op">.</span>Diagnostics</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    removed <span class="op">:=</span> <span class="op">&amp;</span>Removed<span class="op">{</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> block<span class="op">.</span>DefRange<span class="op">,</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    content<span class="op">,</span> moreDiags <span class="op">:=</span> block<span class="op">.</span>Body<span class="op">.</span>Content<span class="op">(</span>removedBlockSchema<span class="op">)</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>    diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> moreDiags<span class="op">...)</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> attr<span class="op">,</span> exists <span class="op">:=</span> content<span class="op">.</span>Attributes<span class="op">[</span><span class="st">&quot;from&quot;</span><span class="op">];</span> exists <span class="op">{</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>        from<span class="op">,</span> traversalDiags <span class="op">:=</span> hcl<span class="op">.</span>AbsTraversalForExpr<span class="op">(</span>attr<span class="op">.</span>Expr<span class="op">)</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>        diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> traversalDiags<span class="op">...)</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">!</span>traversalDiags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>            from<span class="op">,</span> fromDiags <span class="op">:=</span> addrs<span class="op">.</span>ParseRemoveTarget<span class="op">(</span>from<span class="op">)</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>            diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> fromDiags<span class="op">.</span>ToHCL<span class="op">()...)</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>            removed<span class="op">.</span>From <span class="op">=</span> from</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>    removed<span class="op">.</span>Destroy <span class="op">=</span> <span class="ot">true</span></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _<span class="op">,</span> block <span class="op">:=</span> <span class="kw">range</span> content<span class="op">.</span>Blocks <span class="op">{</span></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> block<span class="op">.</span>Type <span class="op">{</span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">&quot;lifecycle&quot;</span><span class="op">:</span></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>            lcContent<span class="op">,</span> lcDiags <span class="op">:=</span> block<span class="op">.</span>Body<span class="op">.</span>Content<span class="op">(</span>removedLifecycleBlockSchema<span class="op">)</span></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>            diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> lcDiags<span class="op">...)</span></span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> attr<span class="op">,</span> exists <span class="op">:=</span> lcContent<span class="op">.</span>Attributes<span class="op">[</span><span class="st">&quot;destroy&quot;</span><span class="op">];</span> exists <span class="op">{</span></span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a>                valDiags <span class="op">:=</span> gohcl<span class="op">.</span>DecodeExpression<span class="op">(</span>attr<span class="op">.</span>Expr<span class="op">,</span> <span class="ot">nil</span><span class="op">,</span> <span class="op">&amp;</span>removed<span class="op">.</span>Destroy<span class="op">)</span></span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a>                diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> valDiags<span class="op">...)</span></span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> removed<span class="op">,</span> diags</span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Going line by line, we will first examine the function:</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> decodeMovedBlock<span class="op">(</span>block <span class="op">*</span>hcl<span class="op">.</span>Block<span class="op">)</span> <span class="op">(*</span>Moved<span class="op">,</span> hcl<span class="op">.</span>Diagnostics<span class="op">)</span> <span class="op">{</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> decodeRemovedBlock<span class="op">(</span>block <span class="op">*</span>hcl<span class="op">.</span>Block<span class="op">)</span> <span class="op">(*</span>Removed<span class="op">,</span> hcl<span class="op">.</span>Diagnostics<span class="op">)</span> <span class="op">{</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> decodeRemovedBlock<span class="op">(</span>block <span class="op">*</span>hcl<span class="op">.</span>Block<span class="op">)</span> <span class="op">(*</span>Removed<span class="op">,</span> hcl<span class="op">.</span>Diagnostics<span class="op">)</span> <span class="op">{</span></span></code></pre></div>
<p>The setup code:</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> diags hcl<span class="op">.</span>Diagnostics</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>moved <span class="op">:=</span> <span class="op">&amp;</span>Moved<span class="op">{</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    DeclRange<span class="op">:</span> block<span class="op">.</span>DefRange<span class="op">,</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>content<span class="op">,</span> moreDiags <span class="op">:=</span> block<span class="op">.</span>Body<span class="op">.</span>Content<span class="op">(</span>movedBlockSchema<span class="op">)</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> moreDiags<span class="op">...)</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb88"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> diags hcl<span class="op">.</span>Diagnostics</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>removed <span class="op">:=</span> <span class="op">&amp;</span>Removed<span class="op">{</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    DeclRange<span class="op">:</span> block<span class="op">.</span>DefRange<span class="op">,</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>content<span class="op">,</span> moreDiags <span class="op">:=</span> block<span class="op">.</span>Body<span class="op">.</span>Content<span class="op">(</span>removedBlockSchema<span class="op">)</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> moreDiags<span class="op">...)</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb89"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> diags hcl<span class="op">.</span>Diagnostics</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>removed <span class="op">:=</span> <span class="op">&amp;</span>Removed<span class="op">{</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    DeclRange<span class="op">:</span> block<span class="op">.</span>DefRange<span class="op">,</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>content<span class="op">,</span> moreDiags <span class="op">:=</span> block<span class="op">.</span>Body<span class="op">.</span>Content<span class="op">(</span>removedBlockSchema<span class="op">)</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> moreDiags<span class="op">...)</span></span></code></pre></div>
<p>Processing the “from” parameter:</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> attr<span class="op">,</span> exists <span class="op">:=</span> content<span class="op">.</span>Attributes<span class="op">[</span><span class="st">&quot;from&quot;</span><span class="op">];</span> exists <span class="op">{</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>    from<span class="op">,</span> traversalDiags <span class="op">:=</span> hcl<span class="op">.</span>AbsTraversalForExpr<span class="op">(</span>attr<span class="op">.</span>Expr<span class="op">)</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> traversalDiags<span class="op">...)</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">!</span>traversalDiags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>        from<span class="op">,</span> fromDiags <span class="op">:=</span> addrs<span class="op">.</span>ParseMoveEndpoint<span class="op">(</span>from<span class="op">)</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>        diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> fromDiags<span class="op">.</span>ToHCL<span class="op">()...)</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>        moved<span class="op">.</span>From <span class="op">=</span> from</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> attr<span class="op">,</span> exists <span class="op">:=</span> content<span class="op">.</span>Attributes<span class="op">[</span><span class="st">&quot;from&quot;</span><span class="op">];</span> exists <span class="op">{</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>    from<span class="op">,</span> traversalDiags <span class="op">:=</span> hcl<span class="op">.</span>AbsTraversalForExpr<span class="op">(</span>attr<span class="op">.</span>Expr<span class="op">)</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> traversalDiags<span class="op">...)</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">!</span>traversalDiags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>        from<span class="op">,</span> fromDiags <span class="op">:=</span> addrs<span class="op">.</span>ParseRemoveEndpoint<span class="op">(</span>from<span class="op">)</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>        diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> fromDiags<span class="op">.</span>ToHCL<span class="op">()...)</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>        removed<span class="op">.</span>From <span class="op">=</span> from</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> attr<span class="op">,</span> exists <span class="op">:=</span> content<span class="op">.</span>Attributes<span class="op">[</span><span class="st">&quot;from&quot;</span><span class="op">];</span> exists <span class="op">{</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>    from<span class="op">,</span> traversalDiags <span class="op">:=</span> hcl<span class="op">.</span>AbsTraversalForExpr<span class="op">(</span>attr<span class="op">.</span>Expr<span class="op">)</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> traversalDiags<span class="op">...)</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">!</span>traversalDiags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>        from<span class="op">,</span> fromDiags <span class="op">:=</span> addrs<span class="op">.</span>ParseRemoveTarget<span class="op">(</span>from<span class="op">)</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>        diags <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>diags<span class="op">,</span> fromDiags<span class="op">.</span>ToHCL<span class="op">()...)</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>        removed<span class="op">.</span>From <span class="op">=</span> from</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The subsequent code in the “moved” (MPL-2.0) and the Terraform
(BUSL-1.1) implementation is not present in OpenTofu (MPL-2.0) and the
function ends with the same return line in all three cases.</p>
<h3 id="the-removedblockschema">The removedBlockSchema</h3>
<p>As before, the <code>removedBlockSchema</code> follows the structure
of the <code>movedBlockSchema</code>.</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> movedBlockSchema <span class="op">=</span> <span class="op">&amp;</span>hcl<span class="op">.</span>BodySchema<span class="op">{</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    Attributes<span class="op">:</span> <span class="op">[]</span>hcl<span class="op">.</span>AttributeSchema<span class="op">{</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>            Name<span class="op">:</span>     <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>            Required<span class="op">:</span> <span class="ot">true</span><span class="op">,</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>            Name<span class="op">:</span>     <span class="st">&quot;to&quot;</span><span class="op">,</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>            Required<span class="op">:</span> <span class="ot">true</span><span class="op">,</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> removedBlockSchema <span class="op">=</span> <span class="op">&amp;</span>hcl<span class="op">.</span>BodySchema<span class="op">{</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    Attributes<span class="op">:</span> <span class="op">[]</span>hcl<span class="op">.</span>AttributeSchema<span class="op">{</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>            Name<span class="op">:</span>     <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>            Required<span class="op">:</span> <span class="ot">true</span><span class="op">,</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> removedBlockSchema <span class="op">=</span> <span class="op">&amp;</span>hcl<span class="op">.</span>BodySchema<span class="op">{</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    Attributes<span class="op">:</span> <span class="op">[]</span>hcl<span class="op">.</span>AttributeSchema<span class="op">{</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>            Name<span class="op">:</span>     <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>            Required<span class="op">:</span> <span class="ot">true</span><span class="op">,</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    Blocks<span class="op">:</span> <span class="op">[]</span>hcl<span class="op">.</span>BlockHeaderSchema<span class="op">{</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>            Type<span class="op">:</span> <span class="st">&quot;lifecycle&quot;</span><span class="op">,</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="on-the-matter-of-the-removed_test.go">On the matter of the
removed_test.go</h2>
<h3 id="the-testremovedblock_decode-function">The
TestRemovedBlock_decode function</h3>
<p>As with the test cases before, we will first show the structure of
the tests and then analyze the test cases individually.</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> TestMovedBlock_decode<span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>    blockRange <span class="op">:=</span> hcl<span class="op">.</span>Range<span class="op">{</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>        Filename<span class="op">:</span> <span class="st">&quot;mock.tf&quot;</span><span class="op">,</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>        Start<span class="op">:</span>    hcl<span class="op">.</span>Pos<span class="op">{</span>Line<span class="op">:</span> <span class="dv">3</span><span class="op">,</span> Column<span class="op">:</span> <span class="dv">12</span><span class="op">,</span> Byte<span class="op">:</span> <span class="dv">27</span><span class="op">},</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>        End<span class="op">:</span>      hcl<span class="op">.</span>Pos<span class="op">{</span>Line<span class="op">:</span> <span class="dv">3</span><span class="op">,</span> Column<span class="op">:</span> <span class="dv">19</span><span class="op">,</span> Byte<span class="op">:</span> <span class="dv">34</span><span class="op">},</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.foo&quot;</span><span class="op">)</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    bar_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.bar&quot;</span><span class="op">)</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>    foo_index_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.foo[1]&quot;</span><span class="op">)</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>    bar_index_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.bar[</span><span class="ch">\&quot;</span><span class="st">one</span><span class="ch">\&quot;</span><span class="st">]&quot;</span><span class="op">)</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>    mod_foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;module.foo&quot;</span><span class="op">)</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>    mod_bar_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;module.bar&quot;</span><span class="op">)</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>    tests <span class="op">:=</span> <span class="kw">map</span><span class="op">[</span><span class="dt">string</span><span class="op">]</span><span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>        input <span class="op">*</span>hcl<span class="op">.</span>Block</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>        want  <span class="op">*</span>Moved</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>        err   <span class="dt">string</span></span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}{</span></span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">// [...]</span></span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> name<span class="op">,</span> test <span class="op">:=</span> <span class="kw">range</span> tests <span class="op">{</span></span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>        t<span class="op">.</span>Run<span class="op">(</span>name<span class="op">,</span> <span class="kw">func</span><span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a>            got<span class="op">,</span> diags <span class="op">:=</span> decodeMovedBlock<span class="op">(</span>test<span class="op">.</span>input<span class="op">)</span></span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> test<span class="op">.</span>err <span class="op">==</span> <span class="st">&quot;&quot;</span> <span class="op">{</span></span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;unexpected error: %s&quot;</span><span class="op">,</span> diags<span class="op">.</span>Errs<span class="op">())</span></span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> gotErr <span class="op">:=</span> diags<span class="op">[</span><span class="dv">0</span><span class="op">].</span>Summary<span class="op">;</span> gotErr <span class="op">!=</span> test<span class="op">.</span>err <span class="op">{</span></span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Errorf<span class="op">(</span><span class="st">&quot;wrong error, got %q, want %q&quot;</span><span class="op">,</span> gotErr<span class="op">,</span> test<span class="op">.</span>err<span class="op">)</span></span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> test<span class="op">.</span>err <span class="op">!=</span> <span class="st">&quot;&quot;</span> <span class="op">{</span></span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a>                t<span class="op">.</span>Fatal<span class="op">(</span><span class="st">&quot;expected error&quot;</span><span class="op">)</span></span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb96-39"><a href="#cb96-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-40"><a href="#cb96-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">!</span>cmp<span class="op">.</span>Equal<span class="op">(</span>got<span class="op">,</span> test<span class="op">.</span>want<span class="op">,</span> cmp<span class="op">.</span>AllowUnexported<span class="op">(</span>addrs<span class="op">.</span>MoveEndpoint<span class="op">{}))</span> <span class="op">{</span></span>
<span id="cb96-41"><a href="#cb96-41" aria-hidden="true" tabindex="-1"></a>                t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;wrong result: %s&quot;</span><span class="op">,</span> cmp<span class="op">.</span>Diff<span class="op">(</span>got<span class="op">,</span> test<span class="op">.</span>want<span class="op">))</span></span>
<span id="cb96-42"><a href="#cb96-42" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb96-43"><a href="#cb96-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span>
<span id="cb96-44"><a href="#cb96-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb96-45"><a href="#cb96-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> TestRemovedBlock_decode<span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>    blockRange <span class="op">:=</span> hcl<span class="op">.</span>Range<span class="op">{</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>        Filename<span class="op">:</span> <span class="st">&quot;mock.tf&quot;</span><span class="op">,</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>        Start<span class="op">:</span>    hcl<span class="op">.</span>Pos<span class="op">{</span>Line<span class="op">:</span> <span class="dv">3</span><span class="op">,</span> Column<span class="op">:</span> <span class="dv">12</span><span class="op">,</span> Byte<span class="op">:</span> <span class="dv">27</span><span class="op">},</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>        End<span class="op">:</span>      hcl<span class="op">.</span>Pos<span class="op">{</span>Line<span class="op">:</span> <span class="dv">3</span><span class="op">,</span> Column<span class="op">:</span> <span class="dv">19</span><span class="op">,</span> Byte<span class="op">:</span> <span class="dv">34</span><span class="op">},</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.foo&quot;</span><span class="op">)</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>    mod_foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;module.foo&quot;</span><span class="op">)</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>    foo_index_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.foo[1]&quot;</span><span class="op">)</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>    mod_boop_index_foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;module.boop[1].test_instance.foo&quot;</span><span class="op">)</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>    data_foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;data.test_instance.foo&quot;</span><span class="op">)</span></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>    tests <span class="op">:=</span> <span class="kw">map</span><span class="op">[</span><span class="dt">string</span><span class="op">]</span><span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>        input <span class="op">*</span>hcl<span class="op">.</span>Block</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>        want  <span class="op">*</span>Removed</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>        err   <span class="dt">string</span></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}{</span></span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// [...]</span></span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> name<span class="op">,</span> test <span class="op">:=</span> <span class="kw">range</span> tests <span class="op">{</span></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>        t<span class="op">.</span>Run<span class="op">(</span>name<span class="op">,</span> <span class="kw">func</span><span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>            got<span class="op">,</span> diags <span class="op">:=</span> decodeRemovedBlock<span class="op">(</span>test<span class="op">.</span>input<span class="op">)</span></span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> test<span class="op">.</span>err <span class="op">==</span> <span class="st">&quot;&quot;</span> <span class="op">{</span></span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;unexpected error: %s&quot;</span><span class="op">,</span> diags<span class="op">.</span>Errs<span class="op">())</span></span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> gotErr <span class="op">:=</span> diags<span class="op">[</span><span class="dv">0</span><span class="op">].</span>Summary<span class="op">;</span> gotErr <span class="op">!=</span> test<span class="op">.</span>err <span class="op">{</span></span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Errorf<span class="op">(</span><span class="st">&quot;wrong error, got %q, want %q&quot;</span><span class="op">,</span> gotErr<span class="op">,</span> test<span class="op">.</span>err<span class="op">)</span></span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> test<span class="op">.</span>err <span class="op">!=</span> <span class="st">&quot;&quot;</span> <span class="op">{</span></span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a>                t<span class="op">.</span>Fatal<span class="op">(</span><span class="st">&quot;expected error&quot;</span><span class="op">)</span></span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">!</span>cmp<span class="op">.</span>Equal<span class="op">(</span>got<span class="op">,</span> test<span class="op">.</span>want<span class="op">,</span> cmp<span class="op">.</span>AllowUnexported<span class="op">(</span>addrs<span class="op">.</span>MoveEndpoint<span class="op">{}))</span> <span class="op">{</span></span>
<span id="cb97-38"><a href="#cb97-38" aria-hidden="true" tabindex="-1"></a>                t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;wrong result: %s&quot;</span><span class="op">,</span> cmp<span class="op">.</span>Diff<span class="op">(</span>got<span class="op">,</span> test<span class="op">.</span>want<span class="op">))</span></span>
<span id="cb97-39"><a href="#cb97-39" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb97-40"><a href="#cb97-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span>
<span id="cb97-41"><a href="#cb97-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb97-42"><a href="#cb97-42" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> TestRemovedBlock_decode<span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>    blockRange <span class="op">:=</span> hcl<span class="op">.</span>Range<span class="op">{</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>        Filename<span class="op">:</span> <span class="st">&quot;mock.tf&quot;</span><span class="op">,</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>        Start<span class="op">:</span>    hcl<span class="op">.</span>Pos<span class="op">{</span>Line<span class="op">:</span> <span class="dv">3</span><span class="op">,</span> Column<span class="op">:</span> <span class="dv">12</span><span class="op">,</span> Byte<span class="op">:</span> <span class="dv">27</span><span class="op">},</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>        End<span class="op">:</span>      hcl<span class="op">.</span>Pos<span class="op">{</span>Line<span class="op">:</span> <span class="dv">3</span><span class="op">,</span> Column<span class="op">:</span> <span class="dv">19</span><span class="op">,</span> Byte<span class="op">:</span> <span class="dv">34</span><span class="op">},</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>    foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.foo&quot;</span><span class="op">)</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    foo_index_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.foo[1]&quot;</span><span class="op">)</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>    mod_foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;module.foo&quot;</span><span class="op">)</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>    mod_foo_index_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;module.foo[1]&quot;</span><span class="op">)</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>    tests <span class="op">:=</span> <span class="kw">map</span><span class="op">[</span><span class="dt">string</span><span class="op">]</span><span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>        input <span class="op">*</span>hcl<span class="op">.</span>Block</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>        want  <span class="op">*</span>Removed</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>        err   <span class="dt">string</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}{</span></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// [...]</span></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> name<span class="op">,</span> test <span class="op">:=</span> <span class="kw">range</span> tests <span class="op">{</span></span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>        t<span class="op">.</span>Run<span class="op">(</span>name<span class="op">,</span> <span class="kw">func</span><span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>            got<span class="op">,</span> diags <span class="op">:=</span> decodeRemovedBlock<span class="op">(</span>test<span class="op">.</span>input<span class="op">)</span></span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> test<span class="op">.</span>err <span class="op">==</span> <span class="st">&quot;&quot;</span> <span class="op">{</span></span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;unexpected error: %s&quot;</span><span class="op">,</span> diags<span class="op">.</span>Errs<span class="op">())</span></span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> gotErr <span class="op">:=</span> diags<span class="op">[</span><span class="dv">0</span><span class="op">].</span>Summary<span class="op">;</span> gotErr <span class="op">!=</span> test<span class="op">.</span>err <span class="op">{</span></span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span>Errorf<span class="op">(</span><span class="st">&quot;wrong error, got %q, want %q&quot;</span><span class="op">,</span> gotErr<span class="op">,</span> test<span class="op">.</span>err<span class="op">)</span></span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> test<span class="op">.</span>err <span class="op">!=</span> <span class="st">&quot;&quot;</span> <span class="op">{</span></span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a>                t<span class="op">.</span>Fatal<span class="op">(</span><span class="st">&quot;expected error&quot;</span><span class="op">)</span></span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">!</span>cmp<span class="op">.</span>Equal<span class="op">(</span>got<span class="op">,</span> test<span class="op">.</span>want<span class="op">,</span> cmp<span class="op">.</span>AllowUnexported<span class="op">(</span>addrs<span class="op">.</span>MoveEndpoint<span class="op">{}))</span> <span class="op">{</span></span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a>                t<span class="op">.</span>Fatalf<span class="op">(</span><span class="st">&quot;wrong result: %s&quot;</span><span class="op">,</span> cmp<span class="op">.</span>Diff<span class="op">(</span>got<span class="op">,</span> test<span class="op">.</span>want<span class="op">))</span></span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The test structure is similar, but individually different from each
other in the variable declaration block:</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.foo&quot;</span><span class="op">)</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>bar_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.bar&quot;</span><span class="op">)</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>foo_index_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.foo[1]&quot;</span><span class="op">)</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>bar_index_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.bar[</span><span class="ch">\&quot;</span><span class="st">one</span><span class="ch">\&quot;</span><span class="st">]&quot;</span><span class="op">)</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>mod_foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;module.foo&quot;</span><span class="op">)</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>mod_bar_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;module.bar&quot;</span><span class="op">)</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.foo&quot;</span><span class="op">)</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>mod_foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;module.foo&quot;</span><span class="op">)</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>foo_index_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.foo[1]&quot;</span><span class="op">)</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>mod_boop_index_foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;module.boop[1].test_instance.foo&quot;</span><span class="op">)</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>data_foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;data.test_instance.foo&quot;</span><span class="op">)</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.foo&quot;</span><span class="op">)</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>foo_index_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;test_instance.foo[1]&quot;</span><span class="op">)</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>mod_foo_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;module.foo&quot;</span><span class="op">)</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>mod_foo_index_expr <span class="op">:=</span> hcltest<span class="op">.</span>MockExprTraversalSrc<span class="op">(</span><span class="st">&quot;module.foo[1]&quot;</span><span class="op">)</span></span></code></pre></div>
<p>Now we will analyze each test case, numbering them by their location
in the Terraform (BUSL-1.1) code and looking for equivalent test cases
in the OpenTofu (MPL-2.0) implementation and the “moved” block
(MPL-2.0).</p>
<h4 id="test-case-1-and-2">Test case 1 and 2:</h4>
<p>These test cases have no equivalent ones in OpenTofu (MPL-2.0) since
the “destroy” option is not present in OpenTofu (MPL-2.0):</p>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;destroy true&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>        Type<span class="op">:</span> <span class="st">&quot;removed&quot;</span><span class="op">,</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>            Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;from&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> foo_expr<span class="op">,</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>            Blocks<span class="op">:</span> hcl<span class="op">.</span>Blocks<span class="op">{</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>                <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>                    Type<span class="op">:</span> <span class="st">&quot;lifecycle&quot;</span><span class="op">,</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>                    Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>                        Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;destroy&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>                                Name<span class="op">:</span> <span class="st">&quot;destroy&quot;</span><span class="op">,</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>                                Expr<span class="op">:</span> hcltest<span class="op">.</span>MockExprLiteral<span class="op">(</span>cty<span class="op">.</span>BoolVal<span class="op">(</span><span class="ot">true</span><span class="op">)),</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>                            <span class="op">},</span></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>                        <span class="op">},</span></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}),</span></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">}),</span></span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a>        DefRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>Removed<span class="op">{</span></span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a>        From<span class="op">:</span>      mustRemoveEndpointFromExpr<span class="op">(</span>foo_expr<span class="op">),</span></span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a>        Destroy<span class="op">:</span>   <span class="ot">true</span><span class="op">,</span></span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb102-32"><a href="#cb102-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span>
<span id="cb102-34"><a href="#cb102-34" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;destroy false&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb102-35"><a href="#cb102-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb102-36"><a href="#cb102-36" aria-hidden="true" tabindex="-1"></a>        Type<span class="op">:</span> <span class="st">&quot;removed&quot;</span><span class="op">,</span></span>
<span id="cb102-37"><a href="#cb102-37" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb102-38"><a href="#cb102-38" aria-hidden="true" tabindex="-1"></a>            Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb102-39"><a href="#cb102-39" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;from&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb102-40"><a href="#cb102-40" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb102-41"><a href="#cb102-41" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> foo_expr<span class="op">,</span></span>
<span id="cb102-42"><a href="#cb102-42" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb102-43"><a href="#cb102-43" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb102-44"><a href="#cb102-44" aria-hidden="true" tabindex="-1"></a>            Blocks<span class="op">:</span> hcl<span class="op">.</span>Blocks<span class="op">{</span></span>
<span id="cb102-45"><a href="#cb102-45" aria-hidden="true" tabindex="-1"></a>                <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb102-46"><a href="#cb102-46" aria-hidden="true" tabindex="-1"></a>                    Type<span class="op">:</span> <span class="st">&quot;lifecycle&quot;</span><span class="op">,</span></span>
<span id="cb102-47"><a href="#cb102-47" aria-hidden="true" tabindex="-1"></a>                    Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb102-48"><a href="#cb102-48" aria-hidden="true" tabindex="-1"></a>                        Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb102-49"><a href="#cb102-49" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;destroy&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb102-50"><a href="#cb102-50" aria-hidden="true" tabindex="-1"></a>                                Name<span class="op">:</span> <span class="st">&quot;destroy&quot;</span><span class="op">,</span></span>
<span id="cb102-51"><a href="#cb102-51" aria-hidden="true" tabindex="-1"></a>                                Expr<span class="op">:</span> hcltest<span class="op">.</span>MockExprLiteral<span class="op">(</span>cty<span class="op">.</span>BoolVal<span class="op">(</span><span class="ot">false</span><span class="op">)),</span></span>
<span id="cb102-52"><a href="#cb102-52" aria-hidden="true" tabindex="-1"></a>                            <span class="op">},</span></span>
<span id="cb102-53"><a href="#cb102-53" aria-hidden="true" tabindex="-1"></a>                        <span class="op">},</span></span>
<span id="cb102-54"><a href="#cb102-54" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}),</span></span>
<span id="cb102-55"><a href="#cb102-55" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb102-56"><a href="#cb102-56" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb102-57"><a href="#cb102-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">}),</span></span>
<span id="cb102-58"><a href="#cb102-58" aria-hidden="true" tabindex="-1"></a>        DefRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb102-59"><a href="#cb102-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb102-60"><a href="#cb102-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>Removed<span class="op">{</span></span>
<span id="cb102-61"><a href="#cb102-61" aria-hidden="true" tabindex="-1"></a>        From<span class="op">:</span>      mustRemoveEndpointFromExpr<span class="op">(</span>foo_expr<span class="op">),</span></span>
<span id="cb102-62"><a href="#cb102-62" aria-hidden="true" tabindex="-1"></a>        Destroy<span class="op">:</span>   <span class="ot">false</span><span class="op">,</span></span>
<span id="cb102-63"><a href="#cb102-63" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb102-64"><a href="#cb102-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb102-65"><a href="#cb102-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb102-66"><a href="#cb102-66" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<h4 id="test-case-3">Test case 3:</h4>
<p>This test case (BUSL-1.1) is functionally equivalent to test case 2
in OpenTofu (MPL-2.0) and test case 3 in the “moved” (MPL-2.0)
implementation.</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;modules&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>        Type<span class="op">:</span> <span class="st">&quot;moved&quot;</span><span class="op">,</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>            Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;from&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> mod_foo_expr<span class="op">,</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;to&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;to&quot;</span><span class="op">,</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> mod_bar_expr<span class="op">,</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}),</span></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>        DefRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>Moved<span class="op">{</span></span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>        From<span class="op">:</span>      mustMoveEndpointFromExpr<span class="op">(</span>mod_foo_expr<span class="op">),</span></span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>        To<span class="op">:</span>        mustMoveEndpointFromExpr<span class="op">(</span>mod_bar_expr<span class="op">),</span></span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;modules&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>        Type<span class="op">:</span> <span class="st">&quot;removed&quot;</span><span class="op">,</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>            Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;from&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> mod_foo_expr<span class="op">,</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}),</span></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>        DefRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>Removed<span class="op">{</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>        From<span class="op">:</span>      mustRemoveEndpointFromExpr<span class="op">(</span>mod_foo_expr<span class="op">),</span></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb105"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;modules&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>        Type<span class="op">:</span> <span class="st">&quot;removed&quot;</span><span class="op">,</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>            Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;from&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> mod_foo_expr<span class="op">,</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>            Blocks<span class="op">:</span> hcl<span class="op">.</span>Blocks<span class="op">{</span></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>                <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>                    Type<span class="op">:</span> <span class="st">&quot;lifecycle&quot;</span><span class="op">,</span></span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>                    Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>                        Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;destroy&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>                                Name<span class="op">:</span> <span class="st">&quot;destroy&quot;</span><span class="op">,</span></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>                                Expr<span class="op">:</span> hcltest<span class="op">.</span>MockExprLiteral<span class="op">(</span>cty<span class="op">.</span>BoolVal<span class="op">(</span><span class="ot">true</span><span class="op">)),</span></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>                            <span class="op">},</span></span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>                        <span class="op">},</span></span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}),</span></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">}),</span></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a>        DefRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>Removed<span class="op">{</span></span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a>        From<span class="op">:</span>      mustRemoveEndpointFromExpr<span class="op">(</span>mod_foo_expr<span class="op">),</span></span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a>        Destroy<span class="op">:</span>   <span class="ot">true</span><span class="op">,</span></span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<h4 id="test-case-4">Test case 4:</h4>
<p>This test case deals with the lifecycle block, which again is unique
to Terraform (BUSL-1.1) and has no equivalent one in OpenTofu (MPL-2.0)
or the “moved” block (MPL-2.0).</p>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">// KEM Unspecified behaviour</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;no lifecycle block&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>        Type<span class="op">:</span> <span class="st">&quot;removed&quot;</span><span class="op">,</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>            Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;from&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> foo_expr<span class="op">,</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}),</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>        DefRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>Removed<span class="op">{</span></span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>        From<span class="op">:</span>      mustRemoveEndpointFromExpr<span class="op">(</span>foo_expr<span class="op">),</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>        Destroy<span class="op">:</span>   <span class="ot">true</span><span class="op">,</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<h4 id="test-case-5">Test case 5:</h4>
<p>This test case (BUSL-1.1) deals with a missing argument. It is
functionally equivalent to the OpenTofu (MPL-2.0) test case 3 and test
case 4 in the “moved” block (MPL-2.0).</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb107"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;error: missing argument&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>        Type<span class="op">:</span> <span class="st">&quot;moved&quot;</span><span class="op">,</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>            Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;from&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> foo_expr<span class="op">,</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}),</span></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>        DefRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>Moved<span class="op">{</span></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>        From<span class="op">:</span>      mustMoveEndpointFromExpr<span class="op">(</span>foo_expr<span class="op">),</span></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Missing required argument&quot;</span><span class="op">,</span></span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb108"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;error: missing argument&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>        Type<span class="op">:</span> <span class="st">&quot;removed&quot;</span><span class="op">,</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>            Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{},</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">}),</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>        DefRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>Removed<span class="op">{</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Missing required argument&quot;</span><span class="op">,</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;error: missing argument&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>        Type<span class="op">:</span> <span class="st">&quot;removed&quot;</span><span class="op">,</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>            Blocks<span class="op">:</span> hcl<span class="op">.</span>Blocks<span class="op">{</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>                <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>                    Type<span class="op">:</span> <span class="st">&quot;lifecycle&quot;</span><span class="op">,</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>                    Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>                        Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;destroy&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>                                Name<span class="op">:</span> <span class="st">&quot;destroy&quot;</span><span class="op">,</span></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>                                Expr<span class="op">:</span> hcltest<span class="op">.</span>MockExprLiteral<span class="op">(</span>cty<span class="op">.</span>BoolVal<span class="op">(</span><span class="ot">true</span><span class="op">)),</span></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>                            <span class="op">},</span></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>                        <span class="op">},</span></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}),</span></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}),</span></span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>        DefRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>Removed<span class="op">{</span></span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a>        Destroy<span class="op">:</span>   <span class="ot">true</span><span class="op">,</span></span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Missing required argument&quot;</span><span class="op">,</span></span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<h4 id="test-case-6">Test case 6:</h4>
<p>This test case (BUSL-1.1) deals with indexed resource instances. It
is functionally equivalent to test case 4 in OpenTofu (MPL-2.0) and test
case 2 in the “moved” block (MPL-2.0), but with an added error necessary
to cover the differing functionality.</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb110"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;indexed resources&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>        Type<span class="op">:</span> <span class="st">&quot;moved&quot;</span><span class="op">,</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>            Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;from&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> foo_index_expr<span class="op">,</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;to&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;to&quot;</span><span class="op">,</span></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> bar_index_expr<span class="op">,</span></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}),</span></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>        DefRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>Moved<span class="op">{</span></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>        From<span class="op">:</span>      mustMoveEndpointFromExpr<span class="op">(</span>foo_index_expr<span class="op">),</span></span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>        To<span class="op">:</span>        mustMoveEndpointFromExpr<span class="op">(</span>bar_index_expr<span class="op">),</span></span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb111"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;error: indexed resources&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>        Type<span class="op">:</span> <span class="st">&quot;removed&quot;</span><span class="op">,</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>            Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;from&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> foo_index_expr<span class="op">,</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}),</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>        DefRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>Removed<span class="op">{</span></span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Resource instance address with keys is not allowed&quot;</span><span class="op">,</span></span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb112"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;error: indexed resource instance&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>        Type<span class="op">:</span> <span class="st">&quot;removed&quot;</span><span class="op">,</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>            Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;from&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> foo_index_expr<span class="op">,</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>            Blocks<span class="op">:</span> hcl<span class="op">.</span>Blocks<span class="op">{</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>                <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>                    Type<span class="op">:</span> <span class="st">&quot;lifecycle&quot;</span><span class="op">,</span></span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>                    Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>                        Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;destroy&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>                                Name<span class="op">:</span> <span class="st">&quot;destroy&quot;</span><span class="op">,</span></span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>                                Expr<span class="op">:</span> hcltest<span class="op">.</span>MockExprLiteral<span class="op">(</span>cty<span class="op">.</span>BoolVal<span class="op">(</span><span class="ot">true</span><span class="op">)),</span></span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>                            <span class="op">},</span></span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>                        <span class="op">},</span></span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}),</span></span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">}),</span></span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>        DefRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>Removed<span class="op">{</span></span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a>        From<span class="op">:</span>      <span class="ot">nil</span><span class="op">,</span></span>
<span id="cb112-29"><a href="#cb112-29" aria-hidden="true" tabindex="-1"></a>        Destroy<span class="op">:</span>   <span class="ot">true</span><span class="op">,</span></span>
<span id="cb112-30"><a href="#cb112-30" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb112-31"><a href="#cb112-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb112-32"><a href="#cb112-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">`Resource instance keys not allowed`</span><span class="op">,</span></span>
<span id="cb112-33"><a href="#cb112-33" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<h4 id="test-case-7">Test case 7:</h4>
<p>This test case (BUSL-1.1) is similar to test case 6 (BUSL-1.1), but
tests indexed modules instead of indexed resources and is necessary to
cover the functionality. It is functionally equivalent to test case 5 in
OpenTofu (MPL-2.0) which is based on test case 2 in the “moved” block
(MPL-2.0).</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb113"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;indexed resources&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>        Type<span class="op">:</span> <span class="st">&quot;moved&quot;</span><span class="op">,</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>            Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;from&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> foo_index_expr<span class="op">,</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;to&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;to&quot;</span><span class="op">,</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> bar_index_expr<span class="op">,</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}),</span></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>        DefRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>Moved<span class="op">{</span></span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>        From<span class="op">:</span>      mustMoveEndpointFromExpr<span class="op">(</span>foo_index_expr<span class="op">),</span></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>        To<span class="op">:</span>        mustMoveEndpointFromExpr<span class="op">(</span>bar_index_expr<span class="op">),</span></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">``</span><span class="op">,</span></span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb114"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;error: indexed modules&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>        Type<span class="op">:</span> <span class="st">&quot;removed&quot;</span><span class="op">,</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>            Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;from&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> mod_boop_index_foo_expr<span class="op">,</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}),</span></span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>        DefRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>Removed<span class="op">{</span></span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Module instance address with keys is not allowed&quot;</span><span class="op">,</span></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;error: indexed module instance&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>        Type<span class="op">:</span> <span class="st">&quot;removed&quot;</span><span class="op">,</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>            Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;from&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>                    Name<span class="op">:</span> <span class="st">&quot;from&quot;</span><span class="op">,</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>                    Expr<span class="op">:</span> mod_foo_index_expr<span class="op">,</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>            Blocks<span class="op">:</span> hcl<span class="op">.</span>Blocks<span class="op">{</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>                <span class="op">&amp;</span>hcl<span class="op">.</span>Block<span class="op">{</span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>                    Type<span class="op">:</span> <span class="st">&quot;lifecycle&quot;</span><span class="op">,</span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>                    Body<span class="op">:</span> hcltest<span class="op">.</span>MockBody<span class="op">(&amp;</span>hcl<span class="op">.</span>BodyContent<span class="op">{</span></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>                        Attributes<span class="op">:</span> hcl<span class="op">.</span>Attributes<span class="op">{</span></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;destroy&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>                                Name<span class="op">:</span> <span class="st">&quot;destroy&quot;</span><span class="op">,</span></span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>                                Expr<span class="op">:</span> hcltest<span class="op">.</span>MockExprLiteral<span class="op">(</span>cty<span class="op">.</span>BoolVal<span class="op">(</span><span class="ot">true</span><span class="op">)),</span></span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>                            <span class="op">},</span></span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a>                        <span class="op">},</span></span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}),</span></span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">}),</span></span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a>        DefRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span>Removed<span class="op">{</span></span>
<span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a>        From<span class="op">:</span>      <span class="ot">nil</span><span class="op">,</span></span>
<span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a>        Destroy<span class="op">:</span>   <span class="ot">true</span><span class="op">,</span></span>
<span id="cb115-30"><a href="#cb115-30" aria-hidden="true" tabindex="-1"></a>        DeclRange<span class="op">:</span> blockRange<span class="op">,</span></span>
<span id="cb115-31"><a href="#cb115-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb115-32"><a href="#cb115-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">`Module instance keys not allowed`</span><span class="op">,</span></span>
<span id="cb115-33"><a href="#cb115-33" aria-hidden="true" tabindex="-1"></a><span class="op">},</span></span></code></pre></div>
<h3 id="the-mustmoveendpointfromexpr-function">The
mustMoveEndpointFromExpr function</h3>
<p>This function is identical in all three implementations and has been
copied from the “moved” block (MPL-2.0) in both cases.</p>
<p><strong>Moved (MPL-2.0):</strong></p>
<div class="sourceCode" id="cb116"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> mustMoveEndpointFromExpr<span class="op">(</span>expr hcl<span class="op">.</span>Expression<span class="op">)</span> <span class="op">*</span>addrs<span class="op">.</span>MoveEndpoint <span class="op">{</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>    traversal<span class="op">,</span> hcldiags <span class="op">:=</span> hcl<span class="op">.</span>AbsTraversalForExpr<span class="op">(</span>expr<span class="op">)</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> hcldiags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">panic</span><span class="op">(</span>hcldiags<span class="op">.</span>Errs<span class="op">())</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>    ep<span class="op">,</span> diags <span class="op">:=</span> addrs<span class="op">.</span>ParseMoveEndpoint<span class="op">(</span>traversal<span class="op">)</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">panic</span><span class="op">(</span>diags<span class="op">.</span>Err<span class="op">())</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ep</span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (OpenTofu, MPL-2.0):</strong></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> mustRemoveEndpointFromExpr<span class="op">(</span>expr hcl<span class="op">.</span>Expression<span class="op">)</span> <span class="op">*</span>addrs<span class="op">.</span>RemoveEndpoint <span class="op">{</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>    traversal<span class="op">,</span> hcldiags <span class="op">:=</span> hcl<span class="op">.</span>AbsTraversalForExpr<span class="op">(</span>expr<span class="op">)</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> hcldiags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">panic</span><span class="op">(</span>hcldiags<span class="op">.</span>Errs<span class="op">())</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>    ep<span class="op">,</span> diags <span class="op">:=</span> addrs<span class="op">.</span>ParseRemoveEndpoint<span class="op">(</span>traversal<span class="op">)</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">panic</span><span class="op">(</span>diags<span class="op">.</span>Err<span class="op">())</span></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ep</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Removed (Terraform, BUSL-1.1):</strong></p>
<div class="sourceCode" id="cb118"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> mustRemoveEndpointFromExpr<span class="op">(</span>expr hcl<span class="op">.</span>Expression<span class="op">)</span> <span class="op">*</span>addrs<span class="op">.</span>RemoveTarget <span class="op">{</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>    traversal<span class="op">,</span> hcldiags <span class="op">:=</span> hcl<span class="op">.</span>AbsTraversalForExpr<span class="op">(</span>expr<span class="op">)</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> hcldiags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">panic</span><span class="op">(</span>hcldiags<span class="op">.</span>Errs<span class="op">())</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>    ep<span class="op">,</span> diags <span class="op">:=</span> addrs<span class="op">.</span>ParseRemoveTarget<span class="op">(</span>traversal<span class="op">)</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> diags<span class="op">.</span>HasErrors<span class="op">()</span> <span class="op">{</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">panic</span><span class="op">(</span>diags<span class="op">.</span>Err<span class="op">())</span></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ep</span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="conclusion">Conclusion</h2>
<p>The allegations of copyright infringement are unsubstantiated as both
the OpenTofu (MPL-2.0) and the Terraform (BUSL-1.1) implementations
appear to be derivative works of the “moved” block implementation.</p>
</body>
</html>
